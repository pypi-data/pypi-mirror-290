define(["@jupyter-widgets/base"],(e=>(()=>{"use strict";var t={49:function(e,t){var o=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,s){function r(e){try{a(n.next(e))}catch(e){s(e)}}function l(e){try{a(n.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,l)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.suspend=t.resume=t.getSampleRate=t.run=t.blob_url=t.audiodata=void 0;class n extends DataView{setFourCC(e,t){for(let o=0;o<4;o++)this.setUint8(e+o,t.charCodeAt(o))}}let i,s,r,l;navigator.mediaDevices?console.log("Info: getUserMedia is supported."):console.log("Error: getUserMedia is not supported.");let a=[];t.audiodata=[],t.blob_url="",t.run=function(e="",t=500){return o(this,void 0,void 0,(function*(){console.log("(1)"),yield function(e,t){return o(this,void 0,void 0,(function*(){if(!i)try{i=new AudioContext,yield i.suspend(),yield i.audioWorklet.addModule(e),s=new AudioWorkletNode(i,"audio-reorder-processor"),console.log(i)}catch(e){return console.log(e),null}return s}))}(e+"/static/audio-processor.js"),console.log(s),console.log("(2)"),yield function(e){return o(this,void 0,void 0,(function*(){if(!r)try{e||(e={video:!1,audio:{channelCount:{ideal:1},sampleRate:{ideal:i.sampleRate},sampleSize:{ideal:16},autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1}});const t=yield navigator.mediaDevices.getUserMedia(e);r=yield i.createMediaStreamSource(t),l=yield t.getAudioTracks()[0].getSettings(),l.sampleRate=l.sampleRate||i.sampleRate,console.log(t),console.log(l)}catch(e){return console.log(e),null}return r}))}(),console.log("(3)"),yield r.connect(s),console.log("(4)"),yield i.resume(),yield setTimeout((()=>{i.suspend()}),t)}))},t.getSampleRate=function(){return l.sampleRate||i.sampleRate},t.resume=function(){a=[],s.port.onmessage=e=>{a.push(e.data)},i.resume(),s.parameters.get("isRecording").setValueAtTime(1,i.currentTime),console.log("recording")},t.suspend=function(){i.suspend(),s.parameters.get("isRecording").setValueAtTime(0,i.currentTime),console.log("suspended");const e=a.reduce(((e,t)=>e+t.length),0);t.audiodata=new Array(e);let o=0;for(const e of a)for(const n of e)t.audiodata[o++]=n;const r=function(e,t){16!==t.sampleSize&&console.log("Warning: SampleSize is not 16 [bit].\n","The sound is forcely quantized as int16 (signed short) sound.",t),1!==t.channelCount&&console.log("Warning: #Channel is not 1 (monoral).\n",'The sound is forcely converted to monaural sound by "(L+R)/2" method.',t);const o=t.sampleRate||48e3,i=2*o,s=a.reduce(((e,t)=>e+t.length),0),r=2*s,l=new ArrayBuffer(44+r),u=new n(l);let d=0;u.setFourCC(d,"RIFF"),d+=4,u.setUint32(d,r+36,!0),d+=4,u.setFourCC(d,"WAVE"),d+=4,u.setFourCC(d,"fmt "),d+=4,u.setUint32(d,16,!0),d+=4,u.setUint16(d,1,!0),d+=2,u.setUint16(d,1,!0),d+=2,u.setUint32(d,o,!0),d+=4,u.setUint32(d,i,!0),d+=4,u.setUint16(d,2,!0),d+=2,u.setUint16(d,16,!0),d+=2,u.setFourCC(d,"data"),d+=4,u.setUint32(d,r,!0),d+=4;for(const t of e)u.setInt16(d,Math.round(32767*t),!0),d+=2;return console.log("Info: sampling_rate = "+o+" length = "+s+", [sample]"),new Blob([u],{type:"audio/wav"})}(t.audiodata,l);console.log(r),t.blob_url=URL.createObjectURL(r)}},112:function(e,t,o){var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),i=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||n(t,e,o)};Object.defineProperty(t,"__esModule",{value:!0}),window.__webpack_public_path__=document.querySelector("body").getAttribute("data-base-url")+"nbextensions/ipyaudioworklet",i(o(607),t)},607:function(e,t,o){var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),i=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||n(t,e,o)};Object.defineProperty(t,"__esModule",{value:!0}),i(o(412),t),i(o(891),t)},412:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MODULE_NAME=t.MODULE_VERSION=void 0;const n=o(147);t.MODULE_VERSION=n.version,t.MODULE_NAME=n.name},891:function(e,t,o){var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&n(t,e,o);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.AudioRecorderView=t.AudioRecorderModel=void 0;const r=o(146),l=o(412),a=s(o(49));let u="/lab";try{if(window.document.body.classList.contains("notebook_app"))u="/nbextensions/ipyaudioworklet";else{const e=window.document.querySelector("#jupyter-config-data"),t=JSON.parse(e.textContent);u=t.fullAppUrl+"/extensions/@naoh16/ipyaudioworklet"}}catch(e){}class d extends r.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:d.model_name,_model_module:d.model_module,_model_module_version:d.model_module_version,_view_name:d.view_name,_view_module:d.view_module,_view_module_version:d.view_module_version,value:"Audio Recorder",audiodata:[],blob_url:"",filename:"default.wav"})}}t.AudioRecorderModel=d,d.serializers=Object.assign({},r.DOMWidgetModel.serializers),d.model_name="AudioRecorderModel",d.model_module=l.MODULE_NAME,d.model_module_version=l.MODULE_VERSION,d.view_name="AudioRecorderView",d.view_module=l.MODULE_NAME,d.view_module_version=l.MODULE_VERSION;class c extends r.DOMWidgetView{render(){this.el.classList.add("jupyter-widgets"),this._message=document.createElement("div"),this.el.appendChild(this._message),this._bootButton=document.createElement("button"),this._bootButton.classList.add("jupyter-widgets","jupyter-button","widget-button"),this._bootButton.textContent="Boot RECORDER",this._bootButton.title="run()",this.el.appendChild(this._bootButton),this._resumeButton=document.createElement("button"),this._resumeButton.classList.add("jupyter-widgets","jupyter-button","widget-button"),this._resumeButton.disabled=!0,this._resumeButton.textContent="Record",this._resumeButton.title="resume()",this.el.appendChild(this._resumeButton),this._suspendButton=document.createElement("button"),this._suspendButton.classList.add("jupyter-widgets","jupyter-button","widget-button"),this._suspendButton.disabled=!0,this._suspendButton.textContent="Stop",this._suspendButton.title="suspend()",this.el.appendChild(this._suspendButton),this._audioControl=document.createElement("audio"),this._audioControl.controls=!0,this.el.appendChild(this._audioControl),this.value_changed(),this.model.on("change:value",this.value_changed,this),this.model.on("msg:custom",this.on_msg,this),this._bootButton.onclick=this._onClickBootButton.bind(this),this._resumeButton.onclick=this._onClickResumeButton.bind(this),this._suspendButton.onclick=this._onClickSuspendButton.bind(this)}value_changed(){this._message.textContent=this.model.get("value")}on_msg(e,t){switch(e.cmd){case"run":this._onClickBootButton();break;case"resume":this._onClickResumeButton();break;case"suspend":this._onClickSuspendButton()}}_onClickBootButton(){this.model.set("value","AudioRecorder is booting..."),this.model.save_changes(),a.run(u).then((e=>{const t=a.getSampleRate()||-1;this.model.set("value","AudioRecorder is ready (Sampling rate: "+String(t)+" Hz)."),this.model.set("sampleRate",t),this.model.save_changes(),this._bootButton.disabled=!0,this._resumeButton.disabled=!1}))}_onClickResumeButton(){a.resume(),this.model.set("value",this._message.textContent+" [RESUME]"),this.model.save_changes(),this._resumeButton.disabled=!0,this._suspendButton.disabled=!1}_onClickSuspendButton(){a.suspend(),this.model.set("audiodata",a.audiodata),this.model.set("blob_url",a.blob_url),this.model.set("value",this._message.textContent+" [SUSPEND]"),this.model.save_changes(),this._audioControl.src=a.blob_url,this._audioControl.title=this.model.get("filename"),this._resumeButton.disabled=!1,this._suspendButton.disabled=!0}}t.AudioRecorderView=c},146:t=>{t.exports=e},147:e=>{e.exports=JSON.parse('{"name":"@naoh16/ipyaudioworklet","version":"0.4.1","description":"A Jupyter Widget for Web Audio Recording using Audio Worklet","keywords":["jupyter","jupyterlab","jupyterlab-extension","widgets"],"files":["lib/**/*.js","dist/*.js","css/*.css"],"homepage":"https://github.com/naoh16/ipyaudioworklet","bugs":{"url":"https://github.com/naoh16/ipyaudioworklet/issues"},"license":"BSD-3-Clause","author":{"name":"Sunao Hara","email":"sunao.hara@gmail.com"},"main":"lib/index.js","types":"./lib/index.d.ts","repository":{"type":"git","url":"https://github.com/naoh16/ipyaudioworklet"},"scripts":{"build":"yarn run build:lib && yarn run build:nbextension && yarn run build:labextension:dev && yarn run build:postprocess","build:prod":"yarn run build:lib && yarn run build:nbextension && yarn run build:labextension && yarn run build:postprocess","build:labextension":"jupyter labextension build .","build:labextension:dev":"jupyter labextension build --development True .","build:lib":"tsc","build:nbextension":"webpack","build:postprocess":"node build-post-process.js","clean":"yarn run clean:lib && yarn run clean:nbextension && yarn run clean:labextension","clean:lib":"rimraf lib","clean:labextension":"rimraf ipyaudioworklet/labextension","clean:nbextension":"rimraf ipyaudioworklet/nbextension/static/index.js","lint":"eslint . --ext .ts,.tsx --fix","lint:check":"eslint . --ext .ts,.tsx","prepack":"yarn run build:lib","test":"jest","watch":"npm-run-all -p watch:*","watch:lib":"tsc -w","watch:nbextension":"webpack --watch --mode=development","watch:labextension":"jupyter labextension watch ."},"dependencies":{"@jupyter-widgets/base":"^1.1.10 || ^2 || ^3 || ^4 || ^5 || ^6"},"devDependencies":{"@babel/core":"^7.5.0","@babel/preset-env":"^7.5.0","@jupyter-widgets/base-manager":"^1.0.2","@jupyterlab/builder":">=3.0.0","@lumino/application":"^1.6.0","@lumino/widgets":"^1.6.0","@types/audioworklet":"^0.0.50","@types/jest":"^26.0.0","@types/webpack-env":"^1.13.6","@typescript-eslint/eslint-plugin":"^3.6.0","@typescript-eslint/parser":"^3.6.0","acorn":"^7.2.0","copy-webpack-plugin":"^11.0.0","css-loader":"^3.2.0","eslint":"^7.4.0","eslint-config-prettier":"^6.11.0","eslint-plugin-prettier":"^3.1.4","fs-extra":"^7.0.0","identity-obj-proxy":"^3.0.0","jest":"^26.0.0","mkdirp":"^0.5.1","npm-run-all":"^4.1.3","prettier":"^2.0.5","rimraf":"^2.6.2","source-map-loader":"^1.1.3","style-loader":"^1.0.0","ts-jest":"^26.0.0","ts-loader":"^8.0.0","typescript":"~4.1.3","webpack":"^5.61.0","webpack-cli":"^4.0.0","write-file-webpack-plugin":"^4.5.1"},"jupyterlab":{"extension":"lib/plugin","outputDir":"ipyaudioworklet/labextension/","sharedPackages":{"@jupyter-widgets/base":{"bundled":false,"singleton":true}}}}')}},o={};return function e(n){var i=o[n];if(void 0!==i)return i.exports;var s=o[n]={exports:{}};return t[n].call(s.exports,s,s.exports,e),s.exports}(112)})()));
//# sourceMappingURL=index.js.map