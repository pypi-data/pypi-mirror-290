import{d as V,h as f,o as l,b as u,e as t,i,w as _,f as r,t as c,c as E,u as D,j as N,k as b,r as y,a as j,l as ee,m as A,p as te,n as ne,_ as q,q as z,F as R,s as F,v as le,x as H,y as W,z as oe,g as se,A as ie}from"./index-2l7Wx10m.js";import{a as P,b as K,c as re,d as J,e as ae,f as ce}from"./chat-jJXxvHp8.js";/* empty css                                                                          *//* empty css                                                                       */import{_ as de}from"./IndexView.vue_vue_type_script_setup_true_lang-0J0oygcY.js";const ue={key:0,style:{"max-width":"560px"}},_e=t("br",null,null,-1),fe=t("br",null,null,-1),he=t("br",null,null,-1),me=t("br",null,null,-1),ve=t("br",null,null,-1),pe=t("br",null,null,-1),xe=t("br",null,null,-1),ye=t("br",null,null,-1),we=t("br",null,null,-1),ge=t("br",null,null,-1),be=t("br",null,null,-1),$e=t("br",null,null,-1),ke=t("br",null,null,-1),Ee=t("br",null,null,-1),Se=t("span",null,[r("朋友圈背景："),t("br")],-1),Ue={key:1,style:{"max-width":"560px"}},Be=t("br",null,null,-1),Ve=t("br",null,null,-1),Ce=t("br",null,null,-1),Me={key:0},Ie=t("br",null,null,-1),Le={key:1},ze=t("br",null,null,-1),Te={key:2},qe=t("br",null,null,-1),De={key:3},Ne=t("br",null,null,-1),je={key:4},He=t("br",null,null,-1),Re={key:5},Oe=t("br",null,null,-1),Fe={key:6},Pe=t("br",null,null,-1),Ae={key:7},We=t("br",null,null,-1),Ke={key:8},Je=t("br",null,null,-1),Xe={key:9},Ge=t("br",null,null,-1),Qe={key:10},Ye=t("br",null,null,-1),Ze={key:11},et=t("br",null,null,-1),X=V({__name:"UserInfoShow",props:{userinfo:{type:Object,default:()=>({})},show_all:{type:Boolean,default:!0,required:!1}},setup(e){return(a,n)=>{const s=f("el-divider"),o=f("el-image");return e.show_all?(l(),u("div",ue,[t("div",null,[i(s,{"content-position":"center"},{default:_(()=>[r("基本信息")]),_:1}),t("span",null,[r("wxid："+c(e.userinfo.wxid),1),_e]),t("span",null,[r("账号："+c(e.userinfo.account),1),fe]),t("span",null,[r("昵称："+c(e.userinfo.nickname),1),he]),t("span",null,[r("备注："+c(e.userinfo.remark),1),me])]),t("div",null,[i(s,{"content-position":"center"},{default:_(()=>[r("个人信息")]),_:1}),t("span",null,[r("性别："+c(e.userinfo.ExtraBuf["性别[1男2女]"]==1?"男":e.userinfo.ExtraBuf["性别[1男2女]"]==2?"女":""),1),ve]),t("span",null,[r("手机："+c(e.userinfo.ExtraBuf.手机号),1),pe]),t("span",null,[r("标签："+c(e.userinfo.LabelIDList.join("/")),1),xe]),t("span",null,[r("描述："+c(e.userinfo.describe),1),ye]),t("span",null,[r("个签："+c(e.userinfo.ExtraBuf.个性签名),1),we]),t("span",null,[r("国家："+c(e.userinfo.ExtraBuf.国),1),ge]),t("span",null,[r("省份："+c(e.userinfo.ExtraBuf.省),1),be]),t("span",null,[r("市名："+c(e.userinfo.ExtraBuf.市),1),$e])]),t("div",null,[i(s,{"content-position":"center"},{default:_(()=>[r("其他信息")]),_:1}),t("span",null,[r("公司："+c(e.userinfo.ExtraBuf.公司名称),1),ke]),t("span",null,[r("企微："+c(e.userinfo.ExtraBuf.企微属性),1),Ee]),Se,e.userinfo.ExtraBuf.朋友圈背景?(l(),E(o,{key:0,src:D(N)(e.userinfo.ExtraBuf.朋友圈背景),alt:"朋友圈背景",style:{"max-width":"200px","max-height":"200px"},"preview-src-list":[D(N)(e.userinfo.ExtraBuf.朋友圈背景)],"hide-on-click-modal":!0},null,8,["src","preview-src-list"])):b("",!0)])])):(l(),u("div",Ue,[t("span",null,[r("wxid："+c(e.userinfo.wxid),1),Be]),t("span",null,[r("账号："+c(e.userinfo.account),1),Ve]),t("span",null,[r("昵称："+c(e.userinfo.nickname),1),Ce]),e.userinfo.remark?(l(),u("span",Me,[r("备注："+c(e.userinfo.remark),1),Ie])):b("",!0),e.userinfo.ExtraBuf&&e.userinfo.ExtraBuf["性别[1男2女]"]?(l(),u("span",Le,[r("性别："+c(e.userinfo.ExtraBuf["性别[1男2女]"]==1?"男":e.userinfo.ExtraBuf["性别[1男2女]"]==2?"女":""),1),ze])):b("",!0),e.userinfo.ExtraBuf&&e.userinfo.ExtraBuf.手机号?(l(),u("span",Te,[r("手机："+c(e.userinfo.ExtraBuf.手机号),1),qe])):b("",!0),e.userinfo.LabelIDList&&e.userinfo.LabelIDList.length>0?(l(),u("span",De,[r("标签："+c(e.userinfo.LabelIDList.join("/")),1),Ne])):b("",!0),e.userinfo.describe?(l(),u("span",je,[r("描述："+c(e.userinfo.describe),1),He])):b("",!0),e.userinfo.ExtraBuf&&e.userinfo.ExtraBuf.个性签名?(l(),u("span",Re,[r("个签："+c(e.userinfo.ExtraBuf.个性签名),1),Oe])):b("",!0),e.userinfo.ExtraBuf&&e.userinfo.ExtraBuf.国?(l(),u("span",Fe,[r("国家："+c(e.userinfo.ExtraBuf.国),1),Pe])):b("",!0),e.userinfo.ExtraBuf&&e.userinfo.ExtraBuf.省?(l(),u("span",Ae,[r("省份："+c(e.userinfo.ExtraBuf.省),1),We])):b("",!0),e.userinfo.ExtraBuf&&e.userinfo.ExtraBuf.市?(l(),u("span",Ke,[r("市名："+c(e.userinfo.ExtraBuf.市),1),Je])):b("",!0),e.userinfo.ExtraBuf&&e.userinfo.ExtraBuf.公司名称?(l(),u("span",Xe,[r("公司："+c(e.userinfo.ExtraBuf.公司名称),1),Ge])):b("",!0),e.userinfo.ExtraBuf&&e.userinfo.ExtraBuf.企微属性?(l(),u("span",Qe,[r("企微："+c(e.userinfo.ExtraBuf.企微属性),1),Ye])):b("",!0),e.userinfo.ExtraBuf&&e.userinfo.ExtraBuf.朋友圈背景?(l(),u("span",Ze,[r("朋友圈背景："),et])):b("",!0),e.userinfo.ExtraBuf&&e.userinfo.ExtraBuf.朋友圈背景?(l(),E(o,{key:12,src:"/api/rs/imgsrc/"+e.userinfo.ExtraBuf.朋友圈背景,style:{"max-width":"200px","max-height":"200px"},alt:"朋友圈背景"},null,8,["src"])):b("",!0)]))}}}),tt=e=>(te("data-v-0836fbf7"),e=e(),ne(),e),nt={style:{padding:"10px 10px"}},lt={slot:"content",class:"tips"},ot=tt(()=>t("br",null,null,-1)),st={key:0,style:{color:"#909399","font-size":"12px"}},it=V({__name:"ContactsList",emits:["wxid"],setup(e,{emit:a}){const n=y([]);j(async()=>{try{n.value=await P()}catch(v){return console.error("Error fetching data:",v),[]}});const o=y(""),d=async()=>{try{if(o.value===""){n.value=await P();return}console.log(o.value),n.value=[];const v=await K(o.value);v!==null&&typeof v=="object"&&Object.entries(v).forEach(([g,$])=>{n.value.push($)})}catch(v){return console.error("Error fetching data:",v),[]}},h=a,m=v=>{v!==void 0&&v.wxid!==void 0&&(console.log("wxid:",v.wxid),h("wxid",v.wxid))};return(v,g)=>{const $=f("el-input"),S=f("el-button"),I=f("el-avatar"),T=f("el-table-column"),U=f("el-tooltip"),M=f("el-table");return l(),u("div",null,[t("div",nt,[i($,{placeholder:"请输入关键字",modelValue:o.value,"onUpdate:modelValue":g[0]||(g[0]=k=>o.value=k),onKeyup:ee(d,["enter"]),style:{width:"170px","margin-left":"15px"}},null,8,["modelValue"]),i(S,{type:"primary",onClick:d,style:{width:"50px"}},{default:_(()=>[r("搜索")]),_:1})]),i(M,{data:n.value,stripe:"",style:{width:"100%"},"max-height":"100%",height:"100%","highlight-current-row":"",loading:"lazy",onCurrentChange:m},{default:_(()=>[i(T,{width:"57"},{default:_(({row:k})=>[k.headImgUrl!==""?(l(),E(I,{key:0,size:33,src:D(N)(k.headImgUrl)},null,8,["src"])):(l(),E(I,{key:1,size:33},{default:_(()=>[r("群")]),_:1}))]),_:1}),i(T,{width:"190"},{default:_(({row:k})=>[i(U,{class:"item",effect:"light",placement:"right"},{content:_(()=>[i(X,{userinfo:k,show_all:!1,style:{"max-width":"600px"}},null,8,["userinfo"])]),default:_(()=>[t("div",lt,[t("span",null,c(D(A)(k)),1),r(),ot,k.nTime?(l(),u("span",st,c(k.nTime),1)):b("",!0)])]),_:2},1024)]),_:1})]),_:1},8,["data"])])}}}),rt=q(it,[["__scopeId","data-v-0836fbf7"]]),at=V({__name:"ChatRecprdsHeader",props:{wxid:{type:String,required:!0}},emits:["exporting"],setup(e,{emit:a}){const n=e,s=y(0),o=y({wxid:"",nOrder:0,nUnReadCount:0,strNickName:"",nStatus:0,nIsSend:0,strContent:"",nMsgLocalID:0,nMsgStatus:0,nTime:"",nMsgType:0,nMsgSubType:0,nickname:"",remark:"",account:"",describe:"",headImgUrl:"",ExtraBuf:{个性签名:"",企微属性:"",公司名称:"",国:"",备注图片:"",备注图片2:"",市:"","性别[1男2女]":0,手机号:"",朋友圈背景:"",省:""},LabelIDList:[]}),d=async()=>{var U,M,k,L,x,B,C;try{const w=await K("",[n.wxid]);return o.value.wxid=n.wxid,o.value.remark=(U=w[n.wxid])==null?void 0:U.remark,o.value.account=(M=w[n.wxid])==null?void 0:M.account,o.value.describe=(k=w[n.wxid])==null?void 0:k.describe,o.value.headImgUrl=(L=w[n.wxid])==null?void 0:L.headImgUrl,o.value.nickname=(x=w[n.wxid])==null?void 0:x.nickname,o.value.LabelIDList=(B=w[n.wxid])==null?void 0:B.LabelIDList,o.value.ExtraBuf=(C=w[n.wxid])==null?void 0:C.ExtraBuf,w}catch(w){return console.error("Error fetching data wxid2user :",w),[]}},h=async()=>{try{s.value=0;const U=await J(n.wxid);return s.value=U||0,U}catch(U){return console.error("Error fetching data msg_count:",U),[]}},m=()=>{S.value=!1,d(),h()};j(()=>{console.log("ChatRecprdsHeader onMounted",n.wxid),m()}),z(()=>n.wxid,async(U,M)=>{U!==M&&m()});const v=y(!1),g=y(!1),$=async()=>{if(g.value){console.log("正在获取实时消息，请稍后再试!");return}g.value=!0;try{const U=await re();return g.value=!1,U}catch{return g.value=!1,[]}},S=y(!1),I=a,T=U=>{I("exporting",U),S.value=U};return(U,M)=>{const k=f("el-text"),L=f("el-col"),x=f("el-row"),B=f("el-dialog");return l(),u(R,null,[i(x,{gutter:5,style:{width:"100%"}},{default:_(()=>[i(L,{span:6,style:{"white-space":"nowrap"}},{default:_(()=>{var C;return[i(k,{class:"label_color mx-1",truncated:""},{default:_(()=>[r("wxid:")]),_:1}),r("  "),i(k,{class:"data_color mx-1",truncated:"",title:(C=o.value)==null?void 0:C.wxid},{default:_(()=>{var w;return[r(c((w=o.value)==null?void 0:w.wxid),1)]}),_:1},8,["title"])]}),_:1}),i(L,{span:6,style:{"white-space":"nowrap"}},{default:_(()=>[i(k,{class:"label_color mx-1",truncated:""},{default:_(()=>[r("名称:")]),_:1}),r("  "),i(k,{class:"data_color mx-1",truncated:"",title:"show_name"},{default:_(()=>[r(c(D(A)(o.value)),1)]),_:1})]),_:1}),i(L,{span:5,style:{"white-space":"nowrap"}},{default:_(()=>[i(k,{class:"label_color mx-1",truncated:""},{default:_(()=>[r("数量:")]),_:1}),r("  "),i(k,{class:"data_color mx-1",truncated:"",title:s.value},{default:_(()=>[r(c(s.value),1)]),_:1},8,["title"])]),_:1}),i(L,{span:2,style:{"white-space":"nowrap"}},{default:_(()=>[i(k,{class:"button_color mx-1 underline",truncated:"",onClick:M[0]||(M[0]=C=>v.value=!v.value)},{default:_(()=>[r(" 详细信息")]),_:1})]),_:1}),i(L,{span:2,style:{"white-space":"nowrap"}},{default:_(()=>[S.value?b("",!0):(l(),E(k,{key:0,class:"button_color mx-1 underline",truncated:"",onClick:M[1]||(M[1]=C=>{T(!0)})},{default:_(()=>[r("导出备份 ")]),_:1})),S.value?(l(),E(k,{key:1,class:"button_color mx-1 underline",truncated:"",onClick:M[2]||(M[2]=C=>{T(!1)})},{default:_(()=>[r("聊天查看 ")]),_:1})):b("",!0)]),_:1}),i(L,{span:3,style:{"white-space":"nowrap"}},{default:_(()=>[i(k,{class:"button_color mx-1 underline",truncated:"",onClick:M[3]||(M[3]=C=>{$()})},{default:_(()=>[r("实时消息 "),g.value?(l(),u(R,{key:0},[r("...")],64)):b("",!0)]),_:1})]),_:1})]),_:1}),i(B,{modelValue:v.value,"onUpdate:modelValue":M[4]||(M[4]=C=>v.value=C),title:"详细信息",width:"600",center:""},{default:_(()=>[i(X,{userinfo:o.value,show_all:!0},null,8,["userinfo"])]),_:1},8,["modelValue"])],64)}}}),ct=q(at,[["__scopeId","data-v-6d9df34e"]]),dt={class:"chat-content"},ut={key:0,class:"word"},_t=["src"],ft={class:"info"},ht={class:"time"},mt=["innerHTML"],vt={key:1,class:"word-my"},pt={class:"info"},xt={class:"time"},yt=["innerHTML"],wt=["src"],gt=V({__name:"MessageText",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(e){const a=n=>(n=n.replace(/\n/g,"<br>"),new DOMParser().parseFromString(n,"text/html").body.innerHTML);return(n,s)=>(l(),u("div",dt,[e.is_sender?(l(),u("div",vt,[t("div",pt,[t("p",xt,c(e.direction),1),t("div",{class:"info-content",innerHTML:a(e.content)},null,8,yt)]),t("img",{src:e.headUrl},null,8,wt)])):(l(),u("div",ut,[t("img",{src:e.headUrl},null,8,_t),t("div",ft,[t("p",ht,c(e.direction),1),t("div",{class:"info-content",innerHTML:a(e.content)},null,8,mt)])]))]))}}),bt=q(gt,[["__scopeId","data-v-522a25d5"]]),$t={class:"chat-content"},kt={key:0,class:"word"},Et=["src"],St={class:"info"},Ut={class:"time"},Bt={class:"demo-image__preview"},Vt={key:1,class:"word-my"},Ct={class:"info"},Mt={class:"time"},It={class:"demo-image__preview"},Lt=["src"],zt=V({__name:"MessageImg",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(e){return(a,n)=>{const s=f("el-image");return l(),u("div",$t,[e.is_sender?(l(),u("div",Vt,[t("div",Ct,[t("p",Mt,c(e.direction),1),t("div",It,[i(s,{style:{"max-width":"150px","max-height":"150px"},src:e.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"initial-index":4,"preview-src-list":[e.src],"hide-on-click-modal":!0,fit:"cover"},null,8,["src","preview-src-list"])])]),t("img",{src:e.headUrl},null,8,Lt)])):(l(),u("div",kt,[t("img",{src:e.headUrl},null,8,Et),t("div",St,[t("p",Ut,c(e.direction),1),t("div",Bt,[i(s,{style:{"max-width":"150px","max-height":"150px"},src:e.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"initial-index":4,"preview-src-list":[e.src],"hide-on-click-modal":!0,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),Tt=q(zt,[["__scopeId","data-v-abeedb47"]]),qt={class:"chat-content"},Dt={key:0,class:"word"},Nt=["src"],jt={class:"info"},Ht={class:"time"},Rt={class:"demo-video__preview"},Ot={controls:"",width:"30%"},Ft=["src"],Pt={key:1,class:"word-my"},At={class:"info"},Wt={class:"time"},Kt={class:"demo-video__preview"},Jt={controls:"",width:"50%"},Xt=["src"],Gt=["src"],Qt=V({__name:"MessageVideo",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(e){return(a,n)=>(l(),u("div",qt,[e.is_sender?(l(),u("div",Pt,[t("div",At,[t("p",Wt,c(e.direction),1),t("div",Kt,[t("video",Jt,[t("source",{src:e.src,type:"video/mp4"},null,8,Xt)])])]),t("img",{src:e.headUrl},null,8,Gt)])):(l(),u("div",Dt,[t("img",{src:e.headUrl},null,8,Nt),t("div",jt,[t("p",Ht,c(e.direction),1),t("div",Rt,[t("video",Ot,[t("source",{src:e.src,type:"video/mp4"},null,8,Ft)])])])]))]))}}),Yt=q(Qt,[["__scopeId","data-v-aa7dcebf"]]),Zt={class:"chat-content"},en={key:0,class:"word"},tn=["src"],nn={class:"info"},ln={class:"time"},on={controls:"",style:{"background-color":"#fff"}},sn=["src"],rn={key:1,class:"word-my"},an={class:"info"},cn={class:"time"},dn={controls:"",style:{"background-color":"#95EC69"}},un=["src"],_n=["src"],fn=V({__name:"MessageAudio",props:{is_sender:{type:Number,default:0},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""},msg:{type:String,default:""}},setup(e){return(a,n)=>(l(),u("div",Zt,[e.is_sender?(l(),u("div",rn,[t("div",an,[t("p",cn,c(e.direction),1),t("audio",dn,[t("source",{src:e.src,type:"audio/wav"},null,8,un)]),i(D(F),{rows:1,readonly:!0,value:e.msg,style:{width:"100%"}},null,8,["value"])]),t("img",{src:e.headUrl},null,8,_n)])):(l(),u("div",en,[t("img",{src:e.headUrl},null,8,tn),t("div",nn,[t("p",ln,c(e.direction),1),t("audio",on,[t("source",{src:e.src,type:"audio/wav"},null,8,sn)]),i(D(F),{rows:1,readonly:!0,value:e.msg,style:{width:"100%"}},null,8,["value"])])]))]))}}),hn=q(fn,[["__scopeId","data-v-c9969dce"]]),mn={class:"chat-content"},vn={key:0,class:"word"},pn=["src"],xn={class:"info"},yn={class:"time"},wn={style:{float:"left"}},gn=["href"],bn={key:1,class:"word-my"},$n={class:"info"},kn={class:"time"},En={style:{float:"right"}},Sn=["href"],Un=["src"],Bn=V({__name:"MessageFile",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(e){const a=e,n=y(""),s=le({file_name:String,file_size:Number,file_size_unit:String});j(async()=>{console.log("文件加载中");const d=await o(a.src);s.file_name=d.file_name,s.file_size=Number(d.file_size)/1024,s.file_size<1024?s.file_size_unit="kb":(s.file_size=s.file_size/1024,s.file_size_unit="mb"),s.file_size=Number(d.file_size)/1024,n.value=`/api/file/${a.src}`});const o=async d=>{try{return await H.post("/api/rs/file_info",{file_path:d})}catch(h){return console.error("Error fetching file_info:",h),""}};return(d,h)=>{const m=f("el-card");return l(),u("div",mn,[e.is_sender?(l(),u("div",bn,[t("div",$n,[t("p",kn,c(e.direction),1),t("div",En,[i(m,{shadow:"hover",style:{width:"fit-content"}},{default:_(()=>[r("文件 ： "),t("a",{href:n.value,download:""},c(s.file_name),9,Sn),t("div",null,[r(" 文件大小："),t("span",null,c(s.file_size)+c(s.file_size_unit),1)])]),_:1})])]),t("img",{src:e.headUrl},null,8,Un)])):(l(),u("div",vn,[t("img",{src:e.headUrl},null,8,pn),t("div",xn,[t("p",yn,c(e.direction),1),t("div",wn,[i(m,{shadow:"hover",style:{width:"fit-content"}},{default:_(()=>[r("文件 ： "),t("a",{href:n.value,download:""},c(s.file_name),9,gn),t("div",null,[r(" 文件大小："),t("span",null,c(s.file_size)+c(s.file_size_unit),1)])]),_:1})])])]))])}}}),Vn=q(Bn,[["__scopeId","data-v-d3aaee81"]]),Cn={class:"chat-content"},Mn={key:0,class:"word"},In=["src"],Ln={class:"info"},zn={class:"time"},Tn={class:"demo-image__preview"},qn={key:1,class:"word-my"},Dn={class:"info"},Nn={class:"time"},jn={class:"demo-image__preview"},Hn=["src"],Rn=V({__name:"MessageEmoji",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(e){return(a,n)=>{const s=f("el-image");return l(),u("div",Cn,[e.is_sender?(l(),u("div",qn,[t("div",Dn,[t("p",Nn,c(e.direction),1),t("div",jn,[i(s,{style:{"max-width":"150px","max-height":"150px"},src:e.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[e.src],"hide-on-click-modal":!0,"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])]),t("img",{src:e.headUrl},null,8,Hn)])):(l(),u("div",Mn,[t("img",{src:e.headUrl},null,8,In),t("div",Ln,[t("p",zn,c(e.direction),1),t("div",Tn,[i(s,{style:{"max-width":"150px","max-height":"150px"},src:e.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[e.src],"hide-on-click-modal":!0,"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),On=q(Rn,[["__scopeId","data-v-5ef83767"]]),Fn={class:"chat-content"},Pn={key:0,class:"word"},An=["src"],Wn={class:"info"},Kn={class:"time"},Jn=["innerHTML"],Xn={key:1,class:"word-my"},Gn={class:"info"},Qn={class:"time"},Yn=["innerHTML"],Zn=["src"],el=V({__name:"MessageOther",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(e){const a=n=>(n=n.replace(/\n/g,"<br>"),new DOMParser().parseFromString(n,"text/html").body.innerHTML);return(n,s)=>(l(),u("div",Fn,[e.is_sender?(l(),u("div",Xn,[t("div",Gn,[t("p",Qn,c(e.direction),1),t("div",{class:"info-content",innerHTML:a(e.content)},null,8,Yn)]),t("img",{src:e.headUrl},null,8,Zn)])):(l(),u("div",Pn,[t("img",{src:e.headUrl},null,8,An),t("div",Wn,[t("p",Kn,c(e.direction),1),t("div",{class:"info-content",innerHTML:a(e.content)},null,8,Jn)])]))]))}}),tl=q(el,[["__scopeId","data-v-d66a86fc"]]),nl={key:0,id:"chat"},ll=["id"],ol=V({__name:"ChatRecordsMain",props:{wxid:{type:String,required:!0}},setup(e){const a=e,n=y([]),s=y({}),o=y(!1),d=y(""),h=y(0),m=y(100),v=y(0),g=y(0),$=y(0),S=x=>(x.talker=="我"&&(x.talker=d.value),`${(C=>{const w=s.value[C.talker];return(w==null?void 0:w.remark)||(w==null?void 0:w.nickname)||(w==null?void 0:w.account)||C.talker})(x)} [${x.type_name}] ${x.CreateTime}`),I=x=>(x.talker=="我"&&(x.talker=d.value),s.value.hasOwnProperty(x.talker)?N(s.value[x.talker].headImgUrl):""),T=async(x="")=>{if(o.value){console.log("正在获取消息，请稍后再试!");return}if(a.wxid==""){console.log("wxid 为空, 请检查!");return}try{o.value=!0,h.value<0&&(h.value=0),console.log("fetchData",a.wxid,h.value,m.value);const B=await ce(a.wxid,h.value,m.value);return n.value=B.msg_list,n.value.length==0?(o.value=!1,B):(s.value=Object.assign(s.value,B.user_list),n.value=n.value.filter((C,w,O)=>w===0||C.id!==O[w-1].id),n.value.sort((C,w)=>C.id-w.id),v.value=n.value[0].id,g.value=n.value[n.value.length-1].id,x=="top"?L(n.value[0].id):x=="bottom"&&L(n.value[n.value.length-1].id),o.value=!1,B)}catch(B){return o.value=!1,console.error("Error fetching data:",B),[]}},U=async()=>{try{if(n.value=[],s.value={},o.value=!1,m.value=m.value||100,v.value=0,g.value=0,d.value=await ae(),$.value=await J(a.wxid),$.value<=0)return;console.log("msg_count.value",$.value,m.value),h.value=Math.floor($.value/m.value)*m.value||0,await T("bottom")}catch(x){return console.error("Error fetching data:",x),[]}};z(()=>a.wxid,(x,B)=>{console.log("username changed： ",B,x),U()}),z(()=>h.value,(x,B)=>{console.log("msg start changed： ",B,x),x>B?T("top"):T("bottom")}),j(()=>{U()});const M=x=>{m.value=x,T()},k=x=>{h.value=(x-1)*m.value},L=x=>{oe(()=>{const B=document.getElementById(`message-${x}`);console.log(`scrollToId： message-${x}`),B&&B.scrollIntoView({behavior:"instant",block:"center"})})};return(x,B)=>{const C=f("el-main"),w=f("el-pagination"),O=f("el-footer"),G=f("el-container"),Q=f("el-skeleton"),Y=f("el-empty");return n.value.length>0&&$.value>0?(l(),u("div",nl,[i(G,{class:"chat-records-main-container"},{default:_(()=>[i(C,{class:"chat-records-main-main"},{default:_(()=>[(l(!0),u(R,null,W(n.value,(p,Z)=>(l(),u("div",{class:"message",key:Z,id:`message-${p.id}`},[p.type_name=="文本"?(l(),E(bt,{key:0,is_sender:p.is_sender,direction:S(p),headUrl:I(p),content:p.msg},null,8,["is_sender","direction","headUrl","content"])):p.type_name=="图片"?(l(),E(Tt,{key:1,is_sender:p.is_sender,direction:S(p),headUrl:I(p),src:D(N)(p.src)},null,8,["is_sender","direction","headUrl","src"])):p.type_name=="动画表情"?(l(),E(On,{key:2,is_sender:p.is_sender,direction:S(p),headUrl:I(p),src:D(N)(p.src)},null,8,["is_sender","direction","headUrl","src"])):p.type_name=="视频"?(l(),E(Yt,{key:3,is_sender:p.is_sender,direction:S(p),headUrl:I(p),src:"/api/rs/video/"+p.src},null,8,["is_sender","direction","headUrl","src"])):p.type_name=="文件"?(l(),E(Vn,{key:4,is_sender:p.is_sender,direction:S(p),headUrl:I(p),src:p.src},null,8,["is_sender","direction","headUrl","src"])):p.type_name=="语音"?(l(),E(hn,{key:5,is_sender:p.is_sender,direction:S(p),headUrl:I(p),src:"/api/rs/"+p.src,msg:p.msg},null,8,["is_sender","direction","headUrl","src","msg"])):(l(),E(tl,{key:6,is_sender:p.is_sender,direction:S(p),headUrl:I(p),content:p.msg},null,8,["is_sender","direction","headUrl","content"]))],8,ll))),128))]),_:1}),i(O,{height:"20px",class:"chat-records-main-footer"},{default:_(()=>[i(w,{background:"",small:"",layout:"sizes, prev, pager, next, jumper",total:$.value,"page-size":m.value,"page-sizes":[50,100,200,300,500],onSizeChange:M,"current-page":Math.floor(h.value/m.value+1),onCurrentChange:k},null,8,["total","page-size","current-page"])]),_:1})]),_:1})])):n.value.length<=0&&$.value>0?(l(),E(Q,{key:1,rows:30,animated:""})):(l(),E(Y,{key:2,description:"无记录"}))}}}),sl=q(ol,[["__scopeId","data-v-11e3cf65"]]),il=t("br",null,null,-1),rl=t("br",null,null,-1),al={style:{position:"relative"}},cl=V({__name:"ExportENDB",props:{wxid:{type:String,required:!0}},setup(e){const a=e;z(()=>a.wxid,(d,h)=>{console.log(d)});const n=y(""),s=y(""),o=async()=>{s.value="请求中...";try{s.value=await H.post("/api/rs/export_endb",{wx_path:n.value})}catch(d){return console.error("Error fetching data msg_count:",d),s.value=`请求失败
`+d,[]}};return(d,h)=>{const m=f("el-input"),v=f("el-button"),g=f("el-divider");return l(),u("div",null,[r(" 微信文件夹路径(可选)： "),i(m,{placeholder:"微信文件夹路径[可为空,空表示使用默认的，无默认会报错](eg: C:\\****\\WeChat Files\\wxid_**** )",modelValue:n.value,"onUpdate:modelValue":h[0]||(h[0]=$=>n.value=$),style:{width:"70%"}},null,8,["modelValue"]),il,rl,t("div",al,[i(v,{type:"primary",onClick:h[1]||(h[1]=$=>o())},{default:_(()=>[r("导出")]),_:1})]),i(g),i(m,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:s.value,"onUpdate:modelValue":h[2]||(h[2]=$=>s.value=$),style:{width:"100%"}},null,8,["modelValue"])])}}}),dl=t("br",null,null,-1),ul=t("br",null,null,-1),_l=t("br",null,null,-1),fl=t("br",null,null,-1),hl={style:{position:"relative"}},ml=V({__name:"ExportDEDB",props:{wxid:{type:String,required:!0}},setup(e){const a=e;z(()=>a.wxid,(h,m)=>{console.log(h)});const n=y(""),s=y(""),o=y(""),d=async()=>{o.value="正在处理中...";try{o.value=await H.post("/api/rs/export_dedb",{key:s.value,wx_path:n.value})}catch(h){return console.error("Error fetching data msg_count:",h),o.value=`请求失败
`+h,[]}};return(h,m)=>{const v=f("el-input"),g=f("el-button"),$=f("el-divider");return l(),u("div",null,[r(" 密钥(可选)： "),i(v,{placeholder:"密钥[可为空,空表示使用默认的，无默认会报错]",modelValue:s.value,"onUpdate:modelValue":m[0]||(m[0]=S=>s.value=S),style:{width:"75%"}},null,8,["modelValue"]),dl,ul,r(" 微信文件夹路径(可选)： "),i(v,{placeholder:"微信文件夹路径[可为空,空表示使用默认的，无默认会报错](eg: C:\\****\\WeChat Files\\wxid_**** )",modelValue:n.value,"onUpdate:modelValue":m[1]||(m[1]=S=>n.value=S),style:{width:"70%"}},null,8,["modelValue"]),_l,fl,t("div",hl,[i(g,{type:"primary",onClick:m[2]||(m[2]=S=>d())},{default:_(()=>[r("导出")]),_:1})]),i($),i(v,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:o.value,"onUpdate:modelValue":m[3]||(m[3]=S=>o.value=S),style:{width:"100%"}},null,8,["modelValue"])])}}}),vl={style:{position:"relative"}},pl=V({__name:"ExportCSV",props:{wxid:{type:String,required:!0}},setup(e){const a=e;z(()=>a.wxid,(o,d)=>{console.log(o)});const n=y(""),s=async()=>{n.value="正在处理中...";try{n.value=await H.post("/api/rs/export_csv",{wxid:a.wxid})}catch(o){return console.error("Error fetching data msg_count:",o),n.value=`请求失败
`+o,[]}};return(o,d)=>{const h=f("el-button"),m=f("el-divider"),v=f("el-input");return l(),u("div",null,[t("div",vl,[i(h,{type:"primary",onClick:d[0]||(d[0]=g=>s())},{default:_(()=>[r("导出")]),_:1})]),i(m),i(v,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:n.value,"onUpdate:modelValue":d[1]||(d[1]=g=>n.value=g),style:{width:"100%"}},null,8,["modelValue"])])}}}),xl={style:{position:"relative"}},yl=V({__name:"ExportJSON",props:{wxid:{type:String,required:!0}},setup(e){const a=e;z(()=>a.wxid,(o,d)=>{console.log(o)}),y([]);const n=y(""),s=async()=>{n.value="正在处理中...";try{n.value=await H.post("/api/rs/export_json",{wxid:a.wxid})}catch(o){return console.error("Error fetching data msg_count:",o),n.value=`请求失败
`+o,[]}};return(o,d)=>{const h=f("el-button"),m=f("el-divider"),v=f("el-input");return l(),u("div",null,[t("div",xl,[i(h,{type:"primary",onClick:d[0]||(d[0]=g=>s())},{default:_(()=>[r("导出")]),_:1})]),i(m),i(v,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:n.value,"onUpdate:modelValue":d[1]||(d[1]=g=>n.value=g),style:{width:"100%"}},null,8,["modelValue"])])}}}),wl={style:{position:"relative"}},gl=V({__name:"ExportHTML",props:{wxid:{type:String,required:!0}},setup(e){const a=e;z(()=>a.wxid,(o,d)=>{console.log(o)}),y([]);const n=y(""),s=async()=>{n.value="正在处理中...";try{n.value=await H.post("/api/rs/export_html",{wxid:a.wxid})}catch(o){return console.error("Error fetching data msg_count:",o),n.value=`请求失败
`+o,[]}};return(o,d)=>{const h=f("el-button"),m=f("el-divider"),v=f("el-input");return l(),u("div",null,[t("div",wl,[i(h,{type:"primary",onClick:d[0]||(d[0]=g=>s())},{default:_(()=>[r("导出")]),_:1})]),i(m),i(v,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:n.value,"onUpdate:modelValue":d[1]||(d[1]=g=>n.value=g),style:{width:"100%"}},null,8,["modelValue"])])}}}),bl=t("br",null,null,-1),$l=V({__name:"ExportPDF",props:{wxid:{type:String,required:!0}},setup(e){const a=e;z(()=>a.wxid,(s,o)=>{console.log(s)});const n=()=>{console.log("requestExport")};return(s,o)=>{const d=f("el-button");return l(),u("div",null,[t("span",null,c(a.wxid),1),bl,i(d,{type:"primary",onClick:o[0]||(o[0]=h=>n())},{default:_(()=>[r("导出")]),_:1})])}}}),kl=t("br",null,null,-1),El=V({__name:"ExportDOCX",props:{wxid:{type:String,required:!0}},setup(e){const a=e;z(()=>a.wxid,(s,o)=>{console.log(s)});const n=()=>{console.log("requestExport")};return(s,o)=>{const d=f("el-button");return l(),u("div",null,[t("span",null,c(a.wxid),1),kl,i(d,{type:"primary",onClick:o[0]||(o[0]=h=>n())},{default:_(()=>[r("导出")]),_:1})])}}}),Sl={id:"chat_export",style:{"background-color":"#d2d2fa",padding:"0"}},Ul={style:{"background-color":"#d2d2fa",height:"calc(100vh - 65px)",display:"grid","place-items":"center"}},Bl={style:{"background-color":"#fff",width:"70%",height:"70%","border-radius":"10px",padding:"20px",overflow:"auto"}},Vl=t("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[t("div",{style:{"font-size":"20px","font-weight":"bold"}},"导出与备份(未完待续...）"),t("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}})],-1),Cl={style:{"margin-top":"20px"}},Ml=t("br",null,null,-1),Il=t("br",null,null,-1),Ll={key:0},zl=V({__name:"ChatExportMain",props:{wxid:{type:String,required:!0}},setup(e){const a=e;z(()=>a.wxid,(o,d)=>{console.log(o)});const n=y("");y("");const s={endb:{brief:"加密文件",detail:"导出的内容为微信加密数据库。可还原回微信,但会覆盖微信后续消息。(全程不解密，所以数据安全)"},dedb:{brief:"解密文件",detail:"导出的文件为解密后的sqlite数据库，并且会自动合并msg和media数据库为同一个，但是无法还原回微信。"},csv:{brief:"csv",detail:"只包含文本，但是可以用excel软件（wps，office）打开。"},json:{brief:"json",detail:"只包含文本，可用于数据分析，情感分析等方面。"},html:{brief:"html-开发中",detail:"主要用于浏览器可视化查看。"},pdf:{brief:"pdf-开发中",detail:"pdf版本。"},docx:{brief:"docx-开发中",detail:"docx版本。"}};return(o,d)=>{const h=f("el-option"),m=f("el-select"),v=f("el-divider"),g=f("el-main");return l(),u("div",Sl,[i(g,{style:{"overflow-y":"auto",height:"calc(100vh - 65px)",padding:"0"}},{default:_(()=>[t("div",Ul,[t("div",Bl,[Vl,t("div",Cl,[r(" 导出类型: "),i(m,{placeholder:"请选择导出类型",style:{width:"50%"},modelValue:n.value,"onUpdate:modelValue":d[0]||(d[0]=$=>n.value=$)},{default:_(()=>[(l(),u(R,null,W(s,($,S)=>i(h,{label:$.brief,value:S,key:S},{default:_(()=>[r(c($.brief),1)]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"]),Ml,Il,n.value?(l(),u("span",Ll,c(s[n.value].detail),1)):b("",!0)]),i(v),n.value=="endb"?(l(),E(cl,{key:0,wxid:a.wxid},null,8,["wxid"])):b("",!0),n.value=="dedb"?(l(),E(ml,{key:1,wxid:a.wxid},null,8,["wxid"])):b("",!0),n.value=="csv"?(l(),E(pl,{key:2,wxid:a.wxid},null,8,["wxid"])):b("",!0),n.value=="json"?(l(),E(yl,{key:3,wxid:a.wxid},null,8,["wxid"])):b("",!0),n.value=="html"?(l(),E(gl,{key:4,wxid:a.wxid},null,8,["wxid"])):b("",!0),n.value=="pdf"?(l(),E($l,{key:5,wxid:a.wxid},null,8,["wxid"])):b("",!0),n.value=="docx"?(l(),E(El,{key:6,wxid:a.wxid},null,8,["wxid"])):b("",!0)])])]),_:1})])}}}),Tl=V({__name:"ChatRecords",props:{wxid:{type:String,required:!0}},setup(e){const a=e,n=y(!1),s=d=>{n.value=d},o=()=>{n.value=!1};return z(()=>a.wxid,async(d,h)=>{d!==h&&o()}),j(()=>{o()}),(d,h)=>{const m=f("el-header"),v=f("el-main"),g=f("el-container");return l(),E(g,null,{default:_(()=>[i(m,{style:{height:"40px","max-height":"40px",width:"100%","background-color":"#d2d2fa","padding-top":"5px"}},{default:_(()=>[i(ct,{wxid:e.wxid,onExporting:s},null,8,["wxid"])]),_:1}),i(v,{style:{height:"calc(100vh - 40px)",padding:"0",margin:"0","background-color":"#f5f5f5"}},{default:_(()=>[n.value?(l(),E(zl,{key:0,wxid:e.wxid},null,8,["wxid"])):(l(),E(sl,{key:1,wxid:e.wxid},null,8,["wxid"]))]),_:1})]),_:1})}}}),ql={id:"chat_view",class:"common-layout"},Dl={key:0,style:{height:"calc(100vh)",width:"100%"}},Nl={key:1,style:{width:"100%",height:"100%"}},Pl=V({__name:"ChatView",setup(e){const a=y("");return j(()=>{se().then(n=>{console.log("API version: "+n)}).catch(n=>{console.error("Error fetching API version:",n)}),ie()}),(n,s)=>{const o=f("el-aside"),d=f("el-container");return l(),u("div",ql,[t("div",null,[i(d,null,{default:_(()=>[i(o,{width:"auto",style:{"overflow-y":"auto",height:"calc(100vh)"}},{default:_(()=>[i(rt,{onWxid:s[0]||(s[0]=h=>{a.value=h})})]),_:1}),a.value!=""?(l(),u("div",Dl,[i(Tl,{wxid:a.value},null,8,["wxid"])])):(l(),u("div",Nl,[i(de)]))]),_:1})])])}}});export{Pl as default};
