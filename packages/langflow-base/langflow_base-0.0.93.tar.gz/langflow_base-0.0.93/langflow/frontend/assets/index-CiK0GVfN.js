import{U as E,a as b,g as D,r as t,u as S,j as e,B as p,I as A,i as I,b as L,e as v,F as P,G as k,H as T,T as j,A as F,J as U,K as $,M as O,N as Y}from"./index-DugHs1zq.js";import{T as G}from"./index-JVT3rcxt.js";import{I as R}from"./input-BBLODMOP.js";const H=a=>{const{mutate:n}=E();return n(["useDeleteApiKey"],async d=>(await b.delete(`${D("API_KEY")}/${d.keyId}`)).data,a)},q=(a,n)=>{const{query:i}=E(),u=async()=>await b.get(`${D("API_KEY")}/`);return i(["useGetApiKeysQuery"],async()=>{const{data:f}=await u();return f},{...n})};function M({children:a,data:n,onCloseModal:i}){const[u,d]=t.useState(!1),[m,f]=t.useState((n==null?void 0:n.apikeyname)??""),[h,g]=t.useState(""),[x,y]=t.useState(!1),[C,K]=t.useState(!0),_=S(o=>o.setSuccessData),l=t.useRef(null);t.useEffect(()=>{u?(y(!1),s()):i()},[u]);function s(){f(""),g("")}const c=async()=>{var o,N;h&&(await navigator.clipboard.writeText(h),(o=l==null?void 0:l.current)==null||o.focus(),(N=l==null?void 0:l.current)==null||N.select(),_({title:P}),K(!1),setTimeout(()=>{K(!0)},3e3))};function r(){k(m).then(o=>{g(o.api_key)}).catch(o=>{})}function w(){x?d(!1):(y(!0),r())}return e.jsxs(p,{onSubmit:w,size:"small-h-full",open:u,setOpen:d,children:[e.jsx(p.Trigger,{children:a}),e.jsxs(p.Header,{description:x?e.jsxs(e.Fragment,{children:[" ","Please save this secret key somewhere safe and accessible. For security reasons,"," ",e.jsx("strong",{children:"you won't be able to view it again"})," through your account. If you lose this secret key, you'll need to generate a new one."]}):e.jsx(e.Fragment,{children:"Create a secret API Key to use Langflow API."}),children:[e.jsx("span",{className:"pr-2",children:"Create API Key"}),e.jsx(A,{name:"Key",className:"h-6 w-6 pl-1 text-foreground","aria-hidden":"true"})]}),e.jsx(p.Content,{children:x?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-full",children:e.jsx(R,{ref:l,readOnly:!0,value:h})}),e.jsx(I,{onClick:()=>{c()},unstyled:!0,children:C?e.jsx(A,{name:"Copy",className:"h-4 w-4"}):e.jsx(A,{name:"Check",className:"h-4 w-4"})})]})}):e.jsx(L,{name:"apikey",children:e.jsx("div",{className:"flex items-center justify-between gap-2",children:e.jsx(v,{asChild:!0,children:e.jsx(R,{id:"primary-input",value:m,ref:l,onChange:({target:{value:o}})=>{f(o)},placeholder:"Insert a name for your API Key"})})})})}),e.jsx(p.Footer,{submit:{label:x?"Done":"Create Secret Key"}})]})}const B=({selectedRows:a,fetchApiKeys:n,userId:i})=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-4 space-y-0.5",children:[e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsxs("h2",{className:"flex items-center text-lg font-semibold tracking-tight",children:["Langflow API",e.jsx(A,{name:"Key",className:"ml-2 h-5 w-5 text-primary"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:T})]}),e.jsx("div",{className:"flex flex-shrink-0 items-center gap-2",children:e.jsx(M,{data:i,onCloseModal:n,children:e.jsxs(I,{"data-testid":"api-key-button-store",variant:"primary",children:[e.jsx(A,{name:"Plus",className:"w-4"}),"Add New"]})})})]})}),Q=B,z=()=>[{headerCheckboxSelection:!0,checkboxSelection:!0,showDisabledCheckboxes:!0,headerName:"Name",field:"name",cellRenderer:j,flex:2},{headerName:"Key",field:"api_key",cellRenderer:j,flex:1},{headerName:"Created",field:"created_at",cellRenderer:j,flex:1},{headerName:"Last Used",field:"last_used_at",cellRenderer:j,flex:1},{headerName:"Total Uses",field:"total_uses",cellRenderer:j,flex:1,resizable:!1}];function X(){t.useState(!0);const[a,n]=t.useState([]),i=S(s=>s.setSuccessData),u=S(s=>s.setErrorData),{userData:d}=t.useContext(F),[m,f]=t.useState(""),[h,g]=t.useState([]),{refetch:x}=q();async function y(){const{data:s}=await x();if(s!==void 0){const c=s.api_keys.map(r=>({...r,name:r.name&&r.name!==""?r.name:"Untitled",last_used_at:r.last_used_at??"Never"}));g(c),f(s.user_id)}}t.useEffect(()=>{d&&y()},[d]);function C(){y()}const{mutate:K}=H();function _(){for(let s=0;s<a.length;s++)K({keyId:a[s]},{onSuccess:()=>{C(),i({title:a.length===1?U:$})},onError:c=>{var r,w;u({title:a.length===1?O:Y,list:[(w=(r=c==null?void 0:c.response)==null?void 0:r.data)==null?void 0:w.detail]})}})}const l=z();return e.jsxs("div",{className:"flex h-full w-full flex-col justify-between gap-6",children:[e.jsx(Q,{selectedRows:a,fetchApiKeys:y,userId:m}),e.jsx("div",{className:"flex h-full w-full flex-col justify-between",children:e.jsx(G,{onDelete:_,overlayNoRowsTemplate:"No data available",onSelectionChanged:s=>{n(s.api.getSelectedRows().map(c=>c.id))},rowSelection:"multiple",suppressRowClickSelection:!0,pagination:!0,columnDefs:l,rowData:h},"apiKeys")})]})}export{X as default};
