import{U as L,a as P,g as R,j as o,ar as de,c as B,aF as V,D,u as $,z as H,aG as ce,aH as ie,aI as ue,aJ as pe,r as I,as as J,i as C,aK as G,I as U,aL as fe}from"./index-DugHs1zq.js";import{H as me}from"./index-CQJAwG_T.js";import{c as ge}from"./index-BTKZZIZD.js";import{b as he,g as Fe}from"./checkbox-Cp8Gj5nb.js";import{I as we}from"./input-BBLODMOP.js";import{a as De}from"./index-DX26fhId.js";const ve=i=>{const{mutate:u}=L();return u(["usePatchFolders"],async n=>{const r={name:n.data.name,description:n.data.description,flows_list:n.data.flows??[],components_list:n.data.components??[]};return(await P.patch(`${R("FOLDERS")}/${n.folderId}`,r)).data},i)},xe=i=>{const{mutate:u}=L();return u(["usePostFolders"],async n=>{const r={name:n.data.name,description:n.data.description,flows_list:n.data.flows??[],components_list:n.data.components??[]};return(await P.post(`${R("FOLDERS")}/`,r)).data},i)},be=i=>{const{mutate:u}=L();return u(["usePostUploadFolders"],async n=>(await P.post(`${R("FOLDERS")}/upload/`,n.formData)).data,i)},ye=({items:i,pathname:u})=>o.jsx("div",{className:"flex gap-2 overflow-auto lg:h-[70vh] lg:flex-col",children:i.map(s=>o.jsx(de,{to:s.href,children:o.jsxs("div",{"data-testid":`sidebar-nav-${s.title}`,className:B(V({variant:"ghost"}),u===s.href?"border border-border bg-muted hover:bg-muted":"border border-transparent hover:border-border hover:bg-transparent","flex w-full shrink-0 justify-start gap-4"),children:[s.icon,o.jsx("span",{className:"block max-w-full truncate opacity-100",children:s.title})]},s.title)}))}),je=ye,Ee=i=>{const{mutate:u}=L();return u(["useGetFolders"],async n=>(await P.get(`${R("FOLDERS")}/download/${n.folderId}`)).data,i)},Ne=(i,u)=>{const s=D(a=>a.setFolderDragging),f=D(a=>a.setFolderIdDragging),n=$(a=>a.setErrorData),r=D(a=>a.refreshFolders),m=H(a=>a.flows),g=De(),j=a=>{u&&u(a)},h=async a=>{if(a.dataTransfer.types.some(l=>l==="Files")&&a.dataTransfer.files&&a.dataTransfer.files.length>0){const l=a.dataTransfer.files[0];l.type==="application/json"?_(l):n({title:ie,list:[ue]})}},x=(a,l)=>{a.preventDefault(),a.dataTransfer.types.some(F=>F==="Files")&&s(!0),f(l)},N=(a,l)=>{a.dataTransfer.types.some(F=>F==="Files")&&s(!0),f(l),a.preventDefault()},S=a=>{a.preventDefault(),a.target===a.currentTarget&&(s(!1),f(""))},v=(a,l)=>{var F,b;if((F=a==null?void 0:a.dataTransfer)!=null&&F.getData("flow")){const E=JSON.parse((b=a==null?void 0:a.dataTransfer)==null?void 0:b.getData("flow"));if(E){T(E.id,l);return}}a.preventDefault(),h(a)},T=(a,l)=>{const F=m==null?void 0:m.find(k=>k.id===a);if(!F)throw new Error("Flow not found");const b={...F,folder_id:l},E=ce(b,m??[]);b.name=E,s(!1),f(""),g(b).then(()=>{r(),j(l)})},_=a=>{const l=new FormData;l.append("file",a),s(!1),f(""),pe(l,i).then(()=>{r(),j(i)})};return{dragOver:x,dragEnter:N,dragLeave:S,onDrop:v}},Se=({pathname:i,handleChangeFolder:u,handleDeleteFolder:s})=>{var A;const f=I.useRef(null),n=D(e=>e.setFolders),r=D(e=>e.folders),[m,g]=I.useState({}),j=H(e=>e.takeSnapshot),[h,x]=I.useState(r.map(e=>({name:e.name,edit:!1}))),N=i.split("/"),S=i.split("/").length<4,v=D(e=>e.myCollectionId),T=D(e=>e.folderIdDragging),_=D(e=>e.refreshFolders),a=e=>S&&e===v?!0:N.includes(e),l=J(),F=((A=l==null?void 0:l.state)==null?void 0:A.folderId)??v,b=D(e=>e.getFolderById),E=$(e=>e.setErrorData),k=$(e=>e.setSuccessData),K=D(e=>e.getFoldersApi),M=he(),W=()=>{b(F)},{dragOver:q,dragEnter:Q,dragLeave:X,onDrop:Y}=Ne(F,W),{mutate:Z}=be(),ee=()=>{ge().then(e=>{Fe(e).then(w=>{w.every(d=>{var t;return(t=d.data)==null?void 0:t.nodes})?M({files:e}).then(()=>{b(F),k({title:"Uploaded successfully"})}):e.forEach(d=>{const t=new FormData;t.append("file",d),Z({formData:t},{onSuccess:()=>{K(!0),k({title:"Folder uploaded successfully."})},onError:c=>{console.log(c),E({title:"Error on upload",list:[c.response.data.message]})}})})})})},{mutate:ae}=Ee(),te=e=>{ae({folderId:e},{onSuccess:w=>{const d=r.find(p=>p.id===w.folderId);w.folder_name=(d==null?void 0:d.name)||"folder",w.folder_description=(d==null?void 0:d.description)||"";const t=`data:text/json;charset=utf-8,${encodeURIComponent(JSON.stringify(w))}`,c=document.createElement("a");c.href=t,c.download=`${w.folder_name}.json`,c.click()},onError:()=>{E({title:"An error occurred while downloading folder."})}})},{mutate:oe}=xe(),{mutate:se}=ve();function ne(){oe({data:{name:"New Folder",parent_id:null,description:""}},{onSuccess:()=>{_()}})}function re(e,w){const{target:{value:d}}=e;g(t=>({...t,[w]:d}))}I.useEffect(()=>{r.map(e=>({name:e.name,edit:!1}))},[r]);const le=async e=>{var d,t;const w=h.map(c=>c.name===e.name?{name:e.name,edit:!1}:{name:c.name,edit:!1});if(x(w),m[e.name].trim()!==""){g(p=>({...p,[e.name]:m[e.name]}));const c={...e,name:m[e.name],flows:((d=e.flows)==null?void 0:d.length)>0?e.flows:[],components:((t=e.components)==null?void 0:t.length)>0?e.components:[]};se({data:c,folderId:e.id},{onSuccess:p=>{const y=r.findIndex(O=>O.id===p.id),z=[...r];z[y]=p,n(z),g({}),x(r.map(O=>({name:O.name,edit:!1})))}})}else g(c=>({...c,[e.name]:e.name}))};return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex shrink-0 items-center justify-between gap-2",children:[o.jsx("div",{className:"flex-1 self-start text-lg font-semibold",children:"Folders"}),o.jsx(C,{variant:"primary",size:"icon",className:"px-2",onClick:ne,"data-testid":"add-folder-button",children:o.jsx(G,{name:"FolderPlus",className:"w-4"})}),o.jsx(C,{variant:"primary",size:"icon",className:"px-2",onClick:ee,"data-testid":"upload-folder-button",children:o.jsx(G,{name:"Upload",className:"w-4"})})]}),o.jsx("div",{className:"flex gap-2 overflow-auto lg:h-[70vh] lg:flex-col",children:o.jsx(o.Fragment,{children:r.map((e,w)=>{const d=h==null?void 0:h.filter(t=>t.name===e.name)[0];return o.jsx("div",{onDragOver:t=>q(t,e.id),onDragEnter:t=>Q(t,e.id),onDragLeave:X,onDrop:t=>Y(t,e.id),"data-testid":`sidebar-nav-${e.name}`,className:B(V({variant:"ghost"}),a(e.id)?"border border-border bg-muted hover:bg-muted":"border hover:bg-transparent lg:border-transparent lg:hover:border-border","group flex w-full shrink-0 cursor-pointer gap-2 opacity-100 lg:min-w-full",T===e.id?"bg-border":""),onClick:()=>u(e.id),children:o.jsxs("div",{onDoubleClick:t=>{var c;if(e.name!=="My Projects"){if(m[e.name]||g({[e.name]:e.name}),(c=h.find(p=>p.name===e.name))!=null&&c.name){const p=h.map(y=>y.name===e.name?{name:e.name,edit:!0}:{name:y.name,edit:!1});x(p),j(),t.stopPropagation(),t.preventDefault();return}x(p=>[...p,{name:e.name,edit:!0}]),g(p=>({...p,[e.name]:e.name})),j(),t.stopPropagation(),t.preventDefault()}},className:"flex w-full items-center gap-2",children:[o.jsx(U,{name:"folder",className:"mr-2 w-4 flex-shrink-0 justify-start stroke-[1.5] opacity-100"}),d!=null&&d.edit?o.jsx("div",{children:o.jsx(we,{className:"w-36",onChange:t=>{re(t,e.name)},ref:f,onKeyDown:t=>{var c;if(t.key==="Escape"){const p=h.map(y=>y.name===e.name?{name:e.name,edit:!1}:{name:y.name,edit:!1});x(p),g({}),x(r.map(y=>({name:y.name,edit:!1})))}t.key==="Enter"&&((c=f.current)==null||c.blur()),fe(t,t.key,"")},autoFocus:!0,onBlur:async()=>{var t;((t=f.current)==null?void 0:t.value)!==e.name?le(e):d.edit=!1},value:m[e.name],id:`input-folder-${e.name}`,"data-testid":"input-folder"})}):o.jsx("span",{className:"block w-full truncate opacity-100",children:e.name}),w>0&&o.jsx(C,{"data-testid":"btn-delete-folder",className:"hidden p-0 hover:bg-white group-hover:block hover:dark:bg-[#0c101a00]",onClick:t=>{s(e),t.stopPropagation(),t.preventDefault()},variant:"ghost",size:"icon",children:o.jsx(U,{name:"trash",className:"w-4 stroke-[1.5] p-0"})}),o.jsx(C,{className:"hidden p-0 hover:bg-white group-hover:block hover:dark:bg-[#0c101a00]",onClick:t=>{te(e.id),t.stopPropagation(),t.preventDefault()},unstyled:!0,children:o.jsx(U,{name:"Download",className:"w-4 stroke-[1.5] text-white"})})]})},e.id)})})})]})},ke=Se;function _e({className:i,items:u,handleChangeFolder:s,handleEditFolder:f,handleDeleteFolder:n,...r}){const g=J().pathname,j=D(v=>v.isLoadingFolders),h=D(v=>v.folders),N=["folder","components","flows","all"].some(v=>g.includes(v)),S=u.length>0?o.jsx(je,{items:u,pathname:g}):!j&&(h==null?void 0:h.length)>0&&N?o.jsx(ke,{pathname:g,handleChangeFolder:s,handleDeleteFolder:n}):null;return o.jsx("nav",{className:B(i),...r,children:o.jsx(me,{children:S})})}export{_e as S};
