import{c as H,d as K}from"./index-BTKZZIZD.js";import{U as R,a as A,g as L,z as g,e0 as D,aj as U,e1 as O,e2 as P,t as W,e3 as B,e4 as X,D as E,e5 as J,aG as Y,u as I,a8 as Q,bf as Z,r as v,bl as ee,bg as te,j as w,bi as M,bj as N,bk as oe,dh as se,c as S,I as T}from"./index-DugHs1zq.js";const ne=t=>{const{mutate:n}=R();return n(["usePostAddFlow"],async c=>(await A.post(`${L("FLOWS")}/`,{name:c.name,data:c.data,description:c.description,is_component:c.is_component,folder_id:c.folder_id||null,endpoint_name:c.endpoint_name||null})).data,t)},ae=t=>{const{mutate:n}=R();return n(["useLoginUser"],async c=>(await A.delete(`${L("FLOWS")}/`,{data:c.flow_ids})).data,t)},re=()=>{const t=g(s=>s.flows),n=g(s=>s.setFlows),o=g(s=>s.setIsLoading),{mutate:u}=ae();return async({id:s})=>new Promise((r,l)=>{Array.isArray(s)||(s=[s]),u({flow_ids:s},{onSuccess:()=>{const{data:e,flows:d}=D((t??[]).filter(a=>!s.includes(a.id)));n(d),o(!1),U.setState(a=>({data:{...a.data,saved_components:e},ComponentFields:O({...a.data,saved_components:e})})),r()},onError:e=>l(e)})})},ce=()=>{const t=P(e=>e.unavailableFields),n=P(e=>e.globalVariablesEntries),o=g(e=>e.flows),u=g(e=>e.setFlows),c=re(),s=g(e=>e.setIsLoading),{mutate:r}=ne();return async e=>new Promise(async(d,a)=>{const i=W.cloneDeep(e==null?void 0:e.flow)??void 0;let m=i?await B(i):{nodes:[],edges:[],viewport:{zoom:1,x:0,y:0}};m==null||m.nodes.forEach(f=>{X(f,m==null?void 0:m.edges,t,n)});const C=E.getState().folderUrl,k=E.getState().myCollectionId;if(e!=null&&e.override&&i){const f=o==null?void 0:o.find(F=>F.name===i.name);f&&await c({id:f.id})}const h=J(m,C||k,i),x=Y(h,o??[]);h.name=x,h.folder_id=E.getState().folderUrl,r(h,{onSuccess:({id:f})=>{h.id=f;const{data:F,flows:p}=D([h,...o??[]]);u(p),U.setState(b=>({data:{...b.data,saved_components:F},ComponentFields:O({...b.data,saved_components:F})})),s(!1),d(f)},onError:f=>{var F,p,b,j;(p=(F=f.response)==null?void 0:F.data)!=null&&p.detail?I.getState().setErrorData({title:"Could not load flows from database",list:[(j=(b=f.response)==null?void 0:b.data)==null?void 0:j.detail]}):I.getState().setErrorData({title:"Could not load flows from database",list:[f.message??"An unexpected error occurred, please try again"]}),s(!1),a(f)}})})};async function ie(t){let n=[];for(const o of t){let u=await o.text(),c=await JSON.parse(u);n.push(c)}return n}const le=()=>{const t=ce(),n=Q(r=>r.paste),o=g(r=>r.refreshFlows),u=async({files:r})=>{const l=await ie(r),e=[];return l.forEach(d=>{d.flows?d.flows.forEach(a=>{e.push(a)}):e.push(d)}),e},c=async({files:r})=>{if(r||(r=await H()),!r.every(l=>l.type==="application/json"))throw new Error("Invalid file type");return await u({files:r})};return async({files:r,isComponent:l,position:e})=>{try{let d=await c({files:r});for(const a of d)await B(a);if(l!==void 0&&d.every(a=>!a.is_component&&l===!0||a.is_component!==void 0&&a.is_component!==l))throw new Error("You cannot upload a component as a flow or vice versa");{let a=e;for(const i of d)if(i.data)a?(n(i.data,a),a={x:a.x+50,y:a.y+50}):await t({flow:i});else throw new Error("Invalid flow data");o()}}catch(d){throw d}}},Fe=le;var _="Checkbox",[de,ve]=Z(_),[ue,fe]=de(_),z=v.forwardRef((t,n)=>{const{__scopeCheckbox:o,name:u,checked:c,defaultChecked:s,required:r,disabled:l,value:e="on",onCheckedChange:d,...a}=t,[i,m]=v.useState(null),C=ee(n,p=>m(p)),k=v.useRef(!1),h=i?!!i.closest("form"):!0,[x=!1,f]=te({prop:c,defaultProp:s,onChange:d}),F=v.useRef(x);return v.useEffect(()=>{const p=i==null?void 0:i.form;if(p){const b=()=>f(F.current);return p.addEventListener("reset",b),()=>p.removeEventListener("reset",b)}},[i,f]),w.jsxs(ue,{scope:o,state:x,disabled:l,children:[w.jsx(M.button,{type:"button",role:"checkbox","aria-checked":y(x)?"mixed":x,"aria-required":r,"data-state":q(x),"data-disabled":l?"":void 0,disabled:l,value:e,...a,ref:C,onKeyDown:N(t.onKeyDown,p=>{p.key==="Enter"&&p.preventDefault()}),onClick:N(t.onClick,p=>{f(b=>y(b)?!0:!b),h&&(k.current=p.isPropagationStopped(),k.current||p.stopPropagation())})}),h&&w.jsx(pe,{control:i,bubbles:!k.current,name:u,value:e,checked:x,required:r,disabled:l,style:{transform:"translateX(-100%)"}})]})});z.displayName=_;var V="CheckboxIndicator",$=v.forwardRef((t,n)=>{const{__scopeCheckbox:o,forceMount:u,...c}=t,s=fe(V,o);return w.jsx(oe,{present:u||y(s.state)||s.state===!0,children:w.jsx(M.span,{"data-state":q(s.state),"data-disabled":s.disabled?"":void 0,...c,ref:n,style:{pointerEvents:"none",...t.style}})})});$.displayName=V;var pe=t=>{const{control:n,checked:o,bubbles:u=!0,...c}=t,s=v.useRef(null),r=K(o),l=se(n);return v.useEffect(()=>{const e=s.current,d=window.HTMLInputElement.prototype,i=Object.getOwnPropertyDescriptor(d,"checked").set;if(r!==o&&i){const m=new Event("click",{bubbles:u});e.indeterminate=y(o),i.call(e,y(o)?!1:o),e.dispatchEvent(m)}},[r,o,u]),w.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:y(o)?!1:o,...c,tabIndex:-1,ref:s,style:{...t.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function y(t){return t==="indeterminate"}function q(t){return y(t)?"indeterminate":t?"checked":"unchecked"}var G=z,we=$;const me=v.forwardRef(({className:t,...n},o)=>w.jsx(G,{ref:o,className:S("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...n,children:w.jsx(we,{className:S("flex items-center justify-center text-current"),children:w.jsx(T,{name:"Check",className:"h-4 w-4 stroke-2"})})}));me.displayName=G.displayName;const xe=({className:t="",checked:n})=>w.jsx("div",{className:S(t,"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n?"bg-primary text-primary-foreground":""),children:n&&w.jsx("div",{className:"flex items-center justify-center text-current",children:w.jsx(T,{name:"Check",className:"h-4 w-4"})})});export{me as C,xe as a,Fe as b,ce as c,ie as g,re as u};
