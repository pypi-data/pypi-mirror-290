import{U as xe,a as ge,g as je,r as f,j as e,c as k,I as D,as as J,u as E,D as h,at as we,i as L,x as Q,ar as ve,z as y}from"./index-DugHs1zq.js";import{b as ye,C as Se,c as be,u as Ce}from"./checkbox-Cp8Gj5nb.js";import{C as De,u as K,a as Ne,F as Fe,S as Z,I as ke}from"./index-BtJhXLEn.js";import{P as Le}from"./index-va40B6Wq.js";import{D as Ee}from"./index-Fwx-o5rU.js";import{N as Ie}from"./index-Cc4RVquG.js";import{S as A}from"./index-JVT3rcxt.js";import{c as Ue}from"./index-r4VfA4EI.js";import"./index-BTKZZIZD.js";import"./index-DEyF4mDW.js";import"./index-BNRQjE7R.js";import"./input-BBLODMOP.js";import"./addNewVariableButton-DOFKcKz2.js";import"./popover-BoT3hib3.js";import"./index-DBvHSJua.js";import"./label-BZZvrSGa.js";import"./separator-zNeG_xON.js";import"./select-y7Zfqo9c.js";import"./index-CKHl3ayo.js";const Me=t=>{const{mutate:n}=xe();return n(["usePostDownloadMultipleFlows"],async o=>(await ge.post(`${je("FLOWS")}/download/`,o.flow_ids,{responseType:"blob"})).data,t)};function Te({onFileDrop:t,children:n,dragMessage:i}){const[a,o]=f.useState(!1);f.useEffect(()=>{const u=()=>{document.visibilityState==="visible"&&o(!1)};return document.addEventListener("visibilitychange",u),()=>{document.removeEventListener("visibilitychange",u)}},[]);const s=u=>{u.preventDefault(),u.dataTransfer.types.some(c=>c==="Files")&&t&&o(!0)},l=u=>{u.dataTransfer.types.some(c=>c==="Files")&&t&&o(!0),u.preventDefault()},p=u=>{u.preventDefault(),t&&o(!1)},m=u=>{u.preventDefault(),t&&t(u),o(!1)};return e.jsx("div",{onDragOver:s,onDragEnter:l,onDragLeave:p,onDrop:m,className:k("h-full w-full",a?"mb-36 flex flex-col items-center justify-center gap-4 text-2xl font-light":""),children:a?e.jsxs(e.Fragment,{children:[e.jsx(D,{name:"ArrowUpToLine",className:"h-12 w-12 stroke-1"}),i||"Drop your file here"]}):n})}const Oe=t=>{var u;const n=J(),i=E(c=>c.setSuccessData),a=E(c=>c.setErrorData),o=h(c=>c.getFolderById),s=(u=n==null?void 0:n.state)==null?void 0:u.folderId,l=h(c=>c.myCollectionId),p=ye();return c=>{if(c.preventDefault(),c.dataTransfer.types.every(d=>d==="Files")){const d=Array.from(c.dataTransfer.files);p({files:d,isComponent:t==="component"?!0:t==="flow"?!1:void 0}).then(()=>{i({title:"All files uploaded successfully"}),o(s||l)}).catch(x=>{console.log(x),a({title:we,list:[x.message]})})}}},Ae=t=>{switch(t){case"all":return"Component or Flow";case"component":return"Component";default:return"Flow"}},_e=(t,n)=>{const i=n==="component",a=(s,l)=>{const p=(s==null?void 0:s.updated_at)||(s==null?void 0:s.date_created),m=(l==null?void 0:l.updated_at)||(l==null?void 0:l.date_created);return p&&m?new Date(m).getTime()-new Date(p).getTime():p?1:m?-1:0},o=n==="all"?t:t==null?void 0:t.filter(s=>((s==null?void 0:s.is_component)??!1)===i);return(o==null?void 0:o.sort(a))??[]},Pe=({})=>{const[t,n]=f.useState(!1);return e.jsx(e.Fragment,{children:e.jsx("div",{className:"mt-2 flex w-full items-center justify-center text-center",children:e.jsx("div",{className:"flex-max-width h-full flex-col",children:e.jsxs("div",{className:"align-center flex w-full justify-center gap-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"This folder is empty. New?"}),e.jsxs("span",{className:"transition-colors hover:text-muted-foreground",children:[e.jsx(Ie,{open:t,setOpen:n}),e.jsx("button",{onClick:()=>{n(!0)},className:"underline",children:"Start Here"})]}),e.jsx("span",{className:"animate-pulse",children:"ðŸš€"})]})})})})},$e=({handleSelectAll:t,handleDelete:n,handleDuplicate:i,handleExport:a,disableFunctions:o,setShouldSelectAll:s,shouldSelectAll:l})=>{const p=()=>{t(l),s(m=>!m)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-4",children:[e.jsx("div",{className:"flex items-center justify-self-start",children:e.jsx("a",{onClick:p,className:"cursor-pointer text-sm",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Se,{checked:!l,id:"terms"}),e.jsx("span",{className:"label text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:l?"Select All":"Unselect All"})]})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:e.jsx(A,{content:o?e.jsx("span",{children:"Select items to export"}):e.jsx("span",{children:"Export selected items"}),children:e.jsx(L,{unstyled:!0,onClick:a,disabled:o,children:e.jsx(D,{name:"FileDown",className:k("h-5 w-5 text-primary transition-all")})})})}),e.jsx("div",{children:e.jsx(A,{content:o?e.jsx("span",{children:"Select items to duplicate"}):e.jsx("span",{children:"Duplicate selected items"}),children:e.jsx(L,{unstyled:!0,onClick:i,disabled:o,children:e.jsx(D,{name:"Copy",className:k("h-5 w-5 text-primary transition-all")})})})}),e.jsx("div",{children:e.jsx(A,{content:o?e.jsx("span",{children:"Select items to delete"}):e.jsx("span",{children:"Delete selected items"}),children:e.jsx(L,{unstyled:!0,onClick:n,disabled:o,children:e.jsx(D,{name:"Trash2",className:k("h-5 w-5 text-primary transition-all",o?"":"hover:text-status-red")})})})})]})]})})},Be=({item:t,type:n,isLoading:i,control:a})=>{const o=Q(),s=t.is_component??!1,l=`/flow/${t.id}`,p=`edit-flow-button-${t.id}`,m=h(w=>w.folderUrl),u=h(w=>w.myCollectionId),d=m!=null&&m!==""?m:u,x=()=>{s||o(l,{state:{folderId:d}})},S=()=>s?null:e.jsx(ve,{to:l,children:e.jsxs(L,{tabIndex:-1,variant:"outline",size:"sm",className:"whitespace-nowrap","data-testid":p,children:[e.jsx(D,{name:"ExternalLink",className:"main-page-nav-button select-none"}),"Edit Flow"]})});return e.jsx(De,{data:{is_component:s,...t},disabled:i,"data-testid":p,button:S(),onClick:s?void 0:x,playground:!s,control:a})},Re=(t,n)=>f.useMemo(()=>{const a=s=>({all:"item",component:"component",flow:"flow"})[s]||"",o=s=>({all:"items",component:"components",flow:"flows"})[s]||"";return(t==null?void 0:t.length)===1?a(n):o(n)},[t,n]),ze=(t,n,i)=>{f.useEffect(()=>{const o=Ue(t||[]).filter(s=>s.name.toLowerCase().includes(n.toLowerCase())||s.description.toLowerCase().includes(n.toLowerCase()));i(n===""?t:o)},[t,n,i])},He=(t,n,i,a,o,s,l,p,m,u,c)=>{const d=be();return{handleDuplicate:f.useCallback(()=>{Promise.all(t.map(S=>d({flow:n.find(w=>w.id===S)}))).then(()=>{i(),a(!0),(!o||o===s)&&l(o||s),p({title:`${c} duplicated successfully`}),m([]),u(!1)})},[t,d,n,i,a,o,s,l,p,m,u,c])}},We=(t,n,i)=>({handleSelectAll:f.useCallback(o=>{const s=t==null?void 0:t.map(l=>l.id);if(o){Object.keys(n()).forEach(l=>{s!=null&&s.includes(l)&&i(l,!0)});return}Object.keys(n()).forEach(l=>{i(l,!1)})},[t,n,i])}),qe=(t,n,i,a,o)=>({handleSelectOptionsChange:f.useCallback(l=>{if(!((t==null?void 0:t.length)>0)){n({title:"No items selected",list:["Please select items to delete"]});return}l==="delete"?i(!0):l==="duplicate"?a():l==="export"&&o()},[t,n,i,a,o])}),Ge=(t,n)=>{f.useEffect(()=>{if(!t||Object.keys(t).length===0)return;const i=Object.keys(t).filter(a=>t[a]===!0);n(i)},[t,n])};function Ke({type:t="all"}){var q;const n=y(r=>r.isLoading),i=y(r=>r.setAllFlows),a=y(r=>r.allFlows),o=h(r=>{var v;return(v=r.selectedFolder)==null?void 0:v.flows}),s=E(r=>r.setSuccessData),l=E(r=>r.setErrorData),[p,m]=f.useState(!1),u=y(r=>r.searchFlowsComponents),c=y(r=>r.setSelectedFlowsComponentsCards),d=y(r=>r.selectedFlowsComponentsCards),x=Oe(t),[S,w]=f.useState(20),[_,P]=f.useState(1),N=J(),I=_e(a,t),$=(_-1)*S,X=$+S,g=I==null?void 0:I.slice($,X),Y=Ae(t),j=(q=N==null?void 0:N.state)==null?void 0:q.folderId,U=h(r=>r.getFolderById),b=h(r=>r.myCollectionId),B=h(r=>r.getFoldersApi),V=h(r=>r.setFolderUrl),R=h(r=>r.isLoadingFolders),ee=h(r=>r.setSelectedFolder),[te,M]=f.useState(!0),z=f.useMemo(()=>window.location.pathname.includes("components")?"Components":window.location.pathname.includes("flows")?"Flows":"Items",[window.location]);f.useEffect(()=>{V(j??""),c([]),F(!1),M(!0),U(j||b)},[N,j,b]),ze(o,u,i);const H=()=>{P(1),w(20)},{getValues:se,control:W,setValue:ne}=K(),le=Ne({control:W}),oe=K(),{handleSelectAll:F}=We(o,se,ne),{handleDuplicate:ae}=He(d,a,H,B,j,b,U,s,c,F,z),{mutate:re}=Me(),ce=()=>{re({flow_ids:d},{onSuccess:r=>{const v=a.find(he=>he.id===d[0]),me=d.length>1?"application/zip":"application/json",G=d.length>1?"_langflow_flows.zip":`${v.name}.json`,fe=new Blob([r],{type:me}),C=document.createElement("a");C.href=window.URL.createObjectURL(fe);let O=new Date().toISOString().replace(/[:.]/g,"");O=O.replace(/-/g,"").replace(/T/g,"").replace(/Z/g,""),C.download=d.length>1?`${O}${G}`:`${G}`,document.body.appendChild(C),C.click(),document.body.removeChild(C),s({title:`${z} exported successfully`}),c([]),F(!1),M(!0)}})},{handleSelectOptionsChange:T}=qe(d,l,m,ae,ce),ie=Ce(),de=()=>{ie({id:d}).then(()=>{i([]),ee(null),H(),B(!0),(!j||j===b)&&U(j||b),s({title:"Selected items deleted successfully"})}).catch(r=>{l({title:"Error deleting items",list:["Please try again"]})})};Ge(le,c);const ue=Re(d,t),pe=()=>{var r;return t==="all"?a==null?void 0:a.length:(r=a==null?void 0:a.filter(v=>(v.is_component??!1)===(t==="component")))==null?void 0:r.length};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex w-full gap-4 pb-5",children:(a==null?void 0:a.length)>0&&e.jsx($e,{shouldSelectAll:te,setShouldSelectAll:M,handleDelete:()=>T("delete"),handleSelectAll:F,handleDuplicate:()=>T("duplicate"),handleExport:()=>T("export"),disableFunctions:!((d==null?void 0:d.length)>0)})}),e.jsx(Te,{onFileDrop:x,dragMessage:`Drag your ${Y} here`,children:e.jsxs("div",{className:"flex h-full w-full flex-col justify-between","data-testid":"cards-wrapper",children:[e.jsx("div",{className:"flex w-full flex-col gap-4",children:!n&&!R&&(g==null?void 0:g.length)===0?e.jsx(Pe,{}):e.jsx("div",{className:"grid w-full gap-4 md:grid-cols-2 lg:grid-cols-2",children:n===!1&&(g==null?void 0:g.length)>0&&R===!1?e.jsx(e.Fragment,{children:g==null?void 0:g.map(r=>f.createElement(Fe,{...oe,key:r.id},e.jsx("form",{children:e.jsx(Be,{item:r,type:t,isLoading:n,control:W})})))}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{}),e.jsx(Z,{})]})})}),!n&&(g==null?void 0:g.length)>0&&e.jsx("div",{className:"relative py-6",children:e.jsx(Le,{storeComponent:!0,pageIndex:_,pageSize:S,rowsCount:[10,20,50,100],totalRowsCount:pe(),paginate:(r,v)=>{P(v),w(r)}})})]})}),p&&e.jsx(Ee,{open:p,setOpen:m,onConfirm:de,description:ue,children:e.jsx(e.Fragment,{})})]})}const Ze=({tabsOptions:t,setActiveTab:n,loading:i,tabActive:a})=>{const o=Q(),s=h(c=>c.folderUrl),l=h(c=>c.myCollectionId),m=s!=null&&s!==""?s:l,u=c=>{const d=window.location.pathname;let x="";switch(c){case"Flows":x=d.replace(/components|all/,"flows");break;case"Components":x=d.replace(/flows|all/,"components");break;default:x=d.replace(/flows|components/,"all");break}o(x,{state:{folderId:m}})};return f.useEffect(()=>{const c=window.location.pathname;c.includes("components")?n("Components"):c.includes("flows")?n("Flows"):n("All")},[window.location.pathname]),e.jsx(e.Fragment,{children:e.jsx("div",{className:"ml-4 flex w-full gap-2 border-b border-border",children:t.map((c,d)=>e.jsx("button",{"data-testid":`${c}-button-store`,disabled:i,onClick:()=>{u(c)},className:(a===c?"border-b-2 border-primary p-3":"border-b-2 border-transparent p-3 text-muted-foreground hover:text-primary")+(i?" cursor-not-allowed":""),children:c},d))})})},Je=({})=>{const t=y(l=>l.isLoading),[n,i]=f.useState("Flows"),[a,o]=f.useState(""),s=y(l=>l.setSearchFlowsComponents);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative flex items-end gap-4",children:[e.jsx(ke,{loading:t,value:a,onChange:l=>{s(l.target.value),o(l.target.value)},onKeyDown:l=>{l.key==="Enter"&&s(a)}}),e.jsx(Ze,{tabsOptions:["All","Flows","Components"],setActiveTab:i,loading:t,tabActive:n})]})})},ht=({type:t})=>e.jsxs(e.Fragment,{children:[e.jsx(Je,{}),e.jsx("div",{className:"mt-5 flex h-full flex-col",children:e.jsx(Ke,{type:t},t)})]});export{ht as default};
