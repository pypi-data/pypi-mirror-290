import{U as ne,a as ie,g as re,r as n,j as e,c as g,C as xe,A as le,B as H,$ as he,b as R,d as A,e as D,f as M,E as K,h as Q,i as X,k as pe,n as fe,u as Y,I as k,l as je,m as Ne,L as ge,o as ve,p as Ce,q,s as W,t as Z,v as be,w as ee}from"./index-DugHs1zq.js";import{u as we}from"./use-patch-update-user-Cwmls1EU.js";import{u as Se}from"./use-post-add-user-B306BuQg.js";import{H as Ee}from"./index-CsuEKUZG.js";import{P as _e}from"./index-va40B6Wq.js";import{S as G}from"./index-JVT3rcxt.js";import{C as se,a as te}from"./checkbox-Cp8Gj5nb.js";import{I as ye}from"./input-BBLODMOP.js";import{C as h}from"./index-dhsXRcH7.js";import"./popover-BoT3hib3.js";import"./index-BTKZZIZD.js";import"./separator-zNeG_xON.js";import"./index-DX26fhId.js";import"./label-BZZvrSGa.js";import"./shortcuts-BAVRR9Ck.js";import"./select-y7Zfqo9c.js";import"./index-CKHl3ayo.js";const Te=r=>{const{mutate:l}=ne();return l(["useDeleteUsers"],async({user_id:p})=>(await ie.delete(`${re("USERS")}/${p}`)).data,r)},Ue=r=>{const{mutate:l}=ne();async function c({skip:p,limit:v}){const a=await ie.get(`${re("USERS")}/?skip=${p}&limit=${v}`);return a.status===200?a.data:[]}return l(["useRefreshAccessToken"],c,r)},ce=n.forwardRef(({className:r,...l},c)=>e.jsx("div",{className:"",children:e.jsx("table",{ref:c,className:g("w-full caption-bottom text-sm",r),...l})}));ce.displayName="Table";const oe=n.forwardRef(({className:r,...l},c)=>e.jsx("thead",{ref:c,className:g("[&_tr]:border-b",r),...l}));oe.displayName="TableHeader";const de=n.forwardRef(({className:r,...l},c)=>e.jsx("tbody",{ref:c,className:g("[&_tr:last-child]:border-0",r),...l}));de.displayName="TableBody";const Re=n.forwardRef(({className:r,...l},c)=>e.jsx("tfoot",{ref:c,className:g("bg-primary font-medium text-primary-foreground",r),...l}));Re.displayName="TableFooter";const J=n.forwardRef(({className:r,...l},c)=>e.jsx("tr",{ref:c,className:g("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...l}));J.displayName="TableRow";const j=n.forwardRef(({className:r,...l},c)=>e.jsx("th",{ref:c,className:g("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...l}));j.displayName="TableHead";const N=n.forwardRef(({className:r,...l},c)=>e.jsx("td",{ref:c,className:g("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...l}));N.displayName="TableCell";const Ae=n.forwardRef(({className:r,...l},c)=>e.jsx("caption",{ref:c,className:g("mt-4 text-sm text-muted-foreground",r),...l}));Ae.displayName="TableCaption";function ae({title:r,titleHeader:l,cancelText:c,confirmationText:_,children:p,icon:v,data:a,index:C,onConfirm:O,asChild:F}){const I=fe[v],[b,w]=n.useState(!1),[S,u]=n.useState(!1),[$,x]=n.useState(!1),[f,E]=n.useState((a==null?void 0:a.password)??""),[y,P]=n.useState((a==null?void 0:a.username)??""),[m,L]=n.useState((a==null?void 0:a.password)??""),[T,z]=n.useState((a==null?void 0:a.is_active)??!1),[U,B]=n.useState((a==null?void 0:a.is_superuser)??!1),[V,s]=n.useState(xe),{userData:t}=n.useContext(le);function i({target:{name:o,value:me}}){s(ue=>({...ue,[o]:me}))}n.useEffect(()=>{a?(i({target:{name:"username",value:y}}),i({target:{name:"is_active",value:T}}),i({target:{name:"is_superuser",value:U}})):d()},[$]);function d(){E(""),P(""),L("")}return e.jsxs(H,{size:"medium-h-full",open:$,setOpen:x,children:[e.jsx(H.Trigger,{asChild:F,children:p}),e.jsxs(H.Header,{description:l,children:[e.jsx("span",{className:"pr-2",children:r}),e.jsx(I,{name:"icon",className:"h-6 w-6 pl-1 text-foreground","aria-hidden":"true"})]}),e.jsx(H.Content,{children:e.jsxs(he,{onSubmit:o=>{if(f!==m){o.preventDefault();return}d(),O(1,V),x(!1),o.preventDefault()},children:[e.jsxs("div",{className:"grid gap-5",children:[e.jsxs(R,{name:"username",children:[e.jsx("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:e.jsxs(A,{className:"data-[invalid]:label-invalid",children:["Username"," ",e.jsx("span",{className:"font-medium text-destructive",children:"*"})]})}),e.jsx(D,{asChild:!0,children:e.jsx("input",{onChange:({target:{value:o}})=>{i({target:{name:"username",value:o}}),P(o)},value:y,className:"primary-input",required:!0,placeholder:"Username"})}),e.jsx(M,{match:"valueMissing",className:"field-invalid",children:"Please enter your username"})]}),e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{className:"mr-3 basis-1/2",children:e.jsxs(R,{name:"password",serverInvalid:f!=m,children:[e.jsx("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:e.jsxs(A,{className:"data-[invalid]:label-invalid flex",children:["Password"," ",e.jsx("span",{className:"ml-1 mr-1 font-medium text-destructive",children:"*"}),b&&e.jsx(K,{onClick:()=>w(!b),className:"h-5 cursor-pointer",strokeWidth:1.5}),!b&&e.jsx(Q,{onClick:()=>w(!b),className:"h-5 cursor-pointer",strokeWidth:1.5})]})}),e.jsx(D,{asChild:!0,children:e.jsx("input",{onChange:({target:{value:o}})=>{i({target:{name:"password",value:o}}),E(o)},value:f,className:"primary-input",required:!a,type:b?"text":"password"})}),e.jsx(M,{className:"field-invalid",match:"valueMissing",children:"Please enter a password"}),f!=m&&e.jsx(M,{className:"field-invalid",children:"Passwords do not match"})]})}),e.jsx("div",{className:"basis-1/2",children:e.jsxs(R,{name:"confirmpassword",serverInvalid:f!=m,children:[e.jsx("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:e.jsxs(A,{className:"data-[invalid]:label-invalid flex",children:["Confirm password"," ",e.jsx("span",{className:"ml-1 mr-1 font-medium text-destructive",children:"*"}),S&&e.jsx(K,{onClick:()=>u(!S),className:"h-5 cursor-pointer",strokeWidth:1.5}),!S&&e.jsx(Q,{onClick:()=>u(!S),className:"h-5 cursor-pointer",strokeWidth:1.5})]})}),e.jsx(D,{asChild:!0,children:e.jsx("input",{onChange:o=>{L(o.target.value)},value:m,className:"primary-input",required:!a,type:S?"text":"password"})}),e.jsx(M,{className:"field-invalid",match:"valueMissing",children:"Please confirm your password"})]})})]}),e.jsxs("div",{className:"flex gap-8",children:[e.jsx(R,{name:"is_active",children:e.jsxs("div",{children:[e.jsx(A,{className:"data-[invalid]:label-invalid mr-3",children:"Active"}),e.jsx(D,{asChild:!0,children:e.jsx(se,{value:T,checked:T,id:"is_active",className:"relative top-0.5",onCheckedChange:o=>{i({target:{name:"is_active",value:o}}),z(o)}})})]})}),(t==null?void 0:t.is_superuser)&&e.jsx(R,{name:"is_superuser",children:e.jsxs("div",{children:[e.jsx(A,{className:"data-[invalid]:label-invalid mr-3",children:"Superuser"}),e.jsx(D,{asChild:!0,children:e.jsx(se,{checked:U,value:U,id:"is_superuser",className:"relative top-0.5",onCheckedChange:o=>{i({target:{name:"is_superuser",value:o}}),B(o)}})})]})})]})]}),e.jsxs("div",{className:"float-right",children:[e.jsx(X,{variant:"outline",onClick:()=>{x(!1)},className:"mr-3",children:c}),e.jsx(pe,{asChild:!0,children:e.jsx(X,{className:"mt-8",children:_})})]})]})})]})}function Je(){const[r,l]=n.useState(""),[c,_]=n.useState(12),[p,v]=n.useState(1),a=Y(s=>s.setSuccessData),C=Y(s=>s.setErrorData),{userData:O}=n.useContext(le),[F,I]=n.useState(0),{mutate:b}=Te(),{mutate:w}=we(),{mutate:S}=Se(),u=n.useRef([]);n.useEffect(()=>{setTimeout(()=>{y()},500)},[]);const[$,x]=n.useState(u.current),{mutate:f,isPending:E}=Ue({});function y(){f({skip:c*(p-1),limit:c},{onSuccess:s=>{I(s.total_count),u.current=s.users,x(s.users)},onError:()=>{}})}function P(s,t){_(t),v(s),f({skip:t*(s-1),limit:t},{onSuccess:i=>{I(i.total_count),u.current=i.users,x(i.users)}})}function m(){v(1),_(12),y()}function L(s){if(l(s),s==="")x(u.current);else{const t=u.current.filter(i=>i.username.toLowerCase().includes(s.toLowerCase()));x(t)}}function T(s){b({user_id:s.id},{onSuccess:()=>{m(),a({title:ve})},onError:t=>{C({title:Ce,list:[t.response.data.detail]})}})}function z(s,t){w({user_id:s,user:t},{onSuccess:()=>{m(),a({title:q})},onError:i=>{C({title:W,list:[i.response.data.detail]})}})}function U(s,t,i){const d=Z.cloneDeep(i);d.is_active=!s,w({user_id:t,user:d},{onSuccess:()=>{m(),a({title:q})},onError:o=>{C({title:W,list:[o.response.data.detail]})}})}function B(s,t,i){const d=Z.cloneDeep(i);d.is_superuser=!s,w({user_id:t,user:d},{onSuccess:()=>{m(),a({title:q})},onError:o=>{C({title:W,list:[o.response.data.detail]})}})}function V(s){S(s,{onSuccess:t=>{w({user_id:t.id,user:{is_active:s.is_active,is_superuser:s.is_superuser}},{onSuccess:()=>{m(),a({title:be})},onError:i=>{C({title:ee,list:[i.response.data.detail]})}})},onError:t=>{C({title:ee,list:[t.response.data.detail]})}})}return e.jsxs(e.Fragment,{children:[e.jsx(Ee,{}),O&&e.jsxs("div",{className:"admin-page-panel flex h-full flex-col pb-8",children:[e.jsx("div",{className:"main-page-nav-arrangement",children:e.jsxs("span",{className:"main-page-nav-title",children:[e.jsx(k,{name:"Shield",className:"w-6"}),je]})}),e.jsx("span",{className:"admin-page-description-text",children:Ne}),e.jsxs("div",{className:"flex w-full justify-between px-4",children:[e.jsxs("div",{className:"flex w-96 items-center gap-4",children:[e.jsx(ye,{placeholder:"Search Username",value:r,onChange:s=>L(s.target.value)}),r.length>0?e.jsx("div",{className:"cursor-pointer",onClick:()=>{l(""),x(u.current)},children:e.jsx(k,{name:"X",className:"w-6 text-foreground"})}):e.jsx("div",{children:e.jsx(k,{name:"Search",className:"w-6 text-foreground"})})]}),e.jsx("div",{children:e.jsx(ae,{title:"New User",titleHeader:"Add a new user",cancelText:"Cancel",confirmationText:"Save",icon:"UserPlus2",onConfirm:(s,t)=>{V(t)},asChild:!0,children:e.jsx(X,{variant:"primary",children:"New User"})})})]}),E?e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx(ge,{remSize:12})}):u.current.length===0?e.jsx(e.Fragment,{children:e.jsx("div",{className:"m-4 flex items-center justify-between text-sm",children:"No users registered."})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"m-4 h-full overflow-x-hidden overflow-y-scroll rounded-md border-2 bg-background custom-scroll"+(E?" border-0":""),children:e.jsxs(ce,{className:"table-fixed outline-1",children:[e.jsx(oe,{className:E?"hidden":"table-fixed bg-muted outline-1",children:e.jsxs(J,{children:[e.jsx(j,{className:"h-10",children:"Id"}),e.jsx(j,{className:"h-10",children:"Username"}),e.jsx(j,{className:"h-10",children:"Active"}),e.jsx(j,{className:"h-10",children:"Superuser"}),e.jsx(j,{className:"h-10",children:"Created At"}),e.jsx(j,{className:"h-10",children:"Updated At"}),e.jsx(j,{className:"h-10 w-[100px] text-right"})]})}),!E&&e.jsx(de,{children:$.map((s,t)=>e.jsxs(J,{children:[e.jsx(N,{className:"truncate py-2 font-medium",children:e.jsx(G,{content:s.id,children:e.jsx("span",{className:"cursor-default",children:s.id})})}),e.jsx(N,{className:"truncate py-2",children:e.jsx(G,{content:s.username,children:e.jsx("span",{className:"cursor-default",children:s.username})})}),e.jsx(N,{className:"relative left-1 truncate py-2 text-align-last-left",children:e.jsxs(h,{size:"x-small",title:"Edit",titleHeader:`${s.username}`,modalContentTitle:"Attention!",cancelText:"Cancel",confirmationText:"Confirm",icon:"UserCog2",data:s,index:t,onConfirm:(i,d)=>{U(d.is_active,d.id,d)},children:[e.jsx(h.Content,{children:e.jsx("span",{children:"Are you completely confident about the changes you are making to this user?"})}),e.jsx(h.Trigger,{children:e.jsx("div",{className:"flex w-fit",children:e.jsx(te,{checked:s.is_active})})})]})}),e.jsx(N,{className:"relative left-1 truncate py-2 text-align-last-left",children:e.jsxs(h,{size:"x-small",title:"Edit",titleHeader:`${s.username}`,modalContentTitle:"Attention!",cancelText:"Cancel",confirmationText:"Confirm",icon:"UserCog2",data:s,index:t,onConfirm:(i,d)=>{B(d.is_superuser,d.id,d)},children:[e.jsx(h.Content,{children:e.jsx("span",{children:"Are you completely confident about the changes you are making to this user?"})}),e.jsx(h.Trigger,{children:e.jsx("div",{className:"flex w-fit",children:e.jsx(te,{checked:s.is_superuser})})})]})}),e.jsx(N,{className:"truncate py-2",children:new Date(s.create_at).toISOString().split("T")[0]}),e.jsx(N,{className:"truncate py-2",children:new Date(s.updated_at).toISOString().split("T")[0]}),e.jsx(N,{className:"flex w-[100px] py-2 text-right",children:e.jsxs("div",{className:"flex",children:[e.jsx(ae,{title:"Edit",titleHeader:`${s.id}`,cancelText:"Cancel",confirmationText:"Save",icon:"UserPlus2",data:s,index:t,onConfirm:(i,d)=>{z(s.id,d)},children:e.jsx(G,{content:"Edit",side:"top",children:e.jsx(k,{name:"Pencil",className:"h-4 w-4 cursor-pointer"})})}),e.jsxs(h,{size:"x-small",title:"Delete",titleHeader:"Delete User",modalContentTitle:"Attention!",cancelText:"Cancel",confirmationText:"Delete",icon:"UserMinus2",data:s,index:t,onConfirm:(i,d)=>{T(d)},children:[e.jsx(h.Content,{children:e.jsx("span",{children:"Are you sure you want to delete this user? This action cannot be undone."})}),e.jsx(h.Trigger,{children:e.jsx(k,{name:"Trash2",className:"ml-2 h-4 w-4 cursor-pointer"})})]})]})})]},t))})]})}),e.jsx(_e,{pageIndex:p,pageSize:c,totalRowsCount:F,paginate:(s,t)=>{P(t,s)}})]})]})]})}export{Je as default};
