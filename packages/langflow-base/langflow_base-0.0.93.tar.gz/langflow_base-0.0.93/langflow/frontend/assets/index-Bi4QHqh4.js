import{U as S,a as v,g as E,aM as te,r as p,j as e,I as ne,$ as N,ay as C,aN as _,aB as b,aA as I,az as R,b as P,f as w,aO as k,k as K,i as y,aP as M,ad as re,aQ as oe,c as le,aR as D,aS as ie,aT as ce,aU as de,aV as ue,aq as me,aW as pe,u as O,A as V,a9 as h,a6 as he,aX as xe,aY as fe,aZ as G,a_ as H,t as ge}from"./index-DugHs1zq.js";import{u as je}from"./use-patch-update-user-Cwmls1EU.js";import{I as A}from"./index-DBvHSJua.js";import"./input-BBLODMOP.js";import"./popover-BoT3hib3.js";const ye=t=>{const{mutate:n}=S();async function o({user_id:s,password:r}){return(await v.patch(`${E("USERS")}/${s}/reset-password`,r)).data}return n(["useResetPassword"],o,t)},Pe=t=>{const{mutate:n}=S();return n(["usePostAddApiKey"],async s=>(await v.post(`${E("API_KEY")}/store`,{api_key:s.key})).data,t)},Y=()=>{const{query:t}=S(),n=async()=>(await v.get(`${E("FILES")}/profile_pictures/list`)).data;return t(["useGetProfilePicturesQuery"],async()=>{var i;const s=await n(),r={};return(i=s==null?void 0:s.files)==null||i.forEach(u=>{const[l,j]=u.split("/");r[l]?r[l].push(j):r[l]=[j]}),r},{placeholderData:te})},we=t=>{p.useEffect(()=>{const n=document.getElementById(t??"null");n&&n.scrollIntoView({behavior:"smooth"})},[t])},Ae=()=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex w-full items-center justify-between gap-4 space-y-0.5",children:e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsxs("h2",{className:"flex items-center text-lg font-semibold tracking-tight",children:["General",e.jsx(ne,{name:"SlidersHorizontal",className:"ml-2 h-5 w-5 text-primary"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage settings related to Langflow and your account."})]})})}),Se=({password:t,cnfPassword:n,handleInput:o,handlePatchPassword:c})=>e.jsx(e.Fragment,{children:e.jsx(N,{onSubmit:s=>{c(t,n,o),s.preventDefault()},children:e.jsxs(C,{"x-chunk":"dashboard-04-chunk-2",children:[e.jsxs(_,{children:[e.jsx(b,{children:"Password"}),e.jsx(I,{children:"Type your new password and confirm it."})]}),e.jsx(R,{children:e.jsxs("div",{className:"flex w-full gap-4",children:[e.jsxs(P,{name:"password",className:"w-full",children:[e.jsx(A,{id:"pasword",onChange:s=>{o({target:{name:"password",value:s}})},value:t,isForm:!0,password:!0,placeholder:"Password",className:"w-full"}),e.jsx(w,{match:"valueMissing",className:"field-invalid",children:"Please enter your password"})]}),e.jsxs(P,{name:"cnfPassword",className:"w-full",children:[e.jsx(A,{id:"cnfPassword",onChange:s=>{o({target:{name:"cnfPassword",value:s}})},value:n,isForm:!0,password:!0,placeholder:"Confirm Password",className:"w-full"}),e.jsx(w,{className:"field-invalid",match:"valueMissing",children:"Please confirm your password"})]})]})}),e.jsx(k,{className:"border-t px-6 py-4",children:e.jsx(K,{asChild:!0,children:e.jsx(y,{type:"submit",children:"Save"})})})]})})}),ve=(t,n,o)=>{const c=async s=>Promise.all(s.map(r=>new Promise(i=>{const u=new Image;u.src=r,u.onload=i,u.onerror=i})));p.useEffect(()=>{if(n||!o)return;const s=[];Object.keys(o).flatMap(r=>o[r].map(i=>s.push(`${M}files/profile_pictures/${r}/${i}`))),c(s).then(()=>{t(!0)})},[o,n])};function Ee({profilePictures:t,loading:n,value:o,onChange:c}){const s=p.useRef(null),r=re(l=>l.dark),[i,u]=p.useState(!1);return p.useEffect(()=>{var l;o&&s&&((l=s.current)==null||l.scrollIntoView({behavior:"smooth",block:"center"}))},[s,o]),ve(u,n,t),e.jsx("div",{className:"flex flex-col justify-center gap-2",children:n||!i?e.jsx(oe,{}):Object.keys(t).map((l,j)=>e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"edit-flow-arrangement",children:e.jsx("span",{className:"font-normal",children:l})}),e.jsx("div",{className:"block overflow-hidden",children:e.jsx("div",{className:"flex items-center gap-1 overflow-x-auto rounded-lg bg-muted px-1 custom-scroll",children:t[l].map((x,f)=>e.jsx(y,{ref:o===l+"/"+x?s:void 0,unstyled:!0,onClick:()=>c(l+"/"+x),className:"shrink-0 px-0.5 py-2",children:e.jsx("img",{src:`${M}files/profile_pictures/${l+"/"+x}`,style:{filter:o===l+"/"+x?r?"drop-shadow(0 0 0.3rem rgb(255, 255, 255))":"drop-shadow(0 0 0.3rem rgb(0, 0, 0))":""},className:le("h-12 w-12")},f)}))})})]}))})}const Ne=({profilePicture:t,handleInput:n,handlePatchProfilePicture:o,handleGetProfilePictures:c,userData:s})=>{const{isLoading:r,data:i,isFetching:u}=Y();return e.jsx(N,{onSubmit:l=>{o(t),l.preventDefault()},children:e.jsxs(C,{"x-chunk":"dashboard-04-chunk-1",children:[e.jsxs(_,{children:[e.jsx(b,{children:"Profile Picture"}),e.jsx(I,{children:"Choose the image that appears as your profile picture."})]}),e.jsx(R,{children:e.jsx("div",{className:"py-2",children:e.jsx(Ee,{profilePictures:i,loading:r||u,value:t==""?(s==null?void 0:s.profile_image)??D[parseInt((s==null?void 0:s.id)??"",30)%D.length]:t,onChange:l=>{n({target:{name:"profilePicture",value:l}})}})})}),e.jsx(k,{className:"border-t px-6 py-4",children:e.jsx(K,{asChild:!0,children:e.jsx(y,{type:"submit",children:"Save"})})})]})})},Ce=({apikey:t,handleInput:n,handleSaveKey:o,loadingApiKey:c,validApiKey:s,hasApiKey:r})=>e.jsx(e.Fragment,{children:e.jsx(N,{onSubmit:i=>{i.preventDefault(),o(t,n)},children:e.jsxs(C,{"x-chunk":"dashboard-04-chunk-2",id:"api",children:[e.jsxs(_,{children:[e.jsx(b,{children:"Store API Key"}),e.jsx(I,{children:(r&&!s?ie:r?"":ce)+de})]}),e.jsx(R,{children:e.jsxs("div",{className:"flex w-full flex-col gap-3",children:[e.jsx("div",{className:"flex w-full gap-4",children:e.jsxs(P,{name:"apikey",className:"w-full",children:[e.jsx(A,{id:"apikey",onChange:i=>{n({target:{name:"apikey",value:i}})},value:t,isForm:!0,password:!0,placeholder:"Insert your API Key",className:"w-full"}),e.jsx(w,{match:"valueMissing",className:"field-invalid",children:"Please enter your API Key"})]})}),e.jsxs("span",{className:"pr-1 text-xs text-muted-foreground",children:[ue," ",e.jsx("a",{className:"text-high-indigo underline",href:"https://langflow.store/",target:"_blank",children:"langflow.store"})]})]})}),e.jsx(k,{className:"border-t px-6 py-4",children:e.jsx(K,{asChild:!0,children:e.jsx(y,{loading:c,type:"submit","data-testid":"api-key-save-button-store",children:"Save"})})})]})})}),Ke=()=>{const{scrollId:t}=me(),[n,o]=p.useState(pe),c=O(a=>a.setSuccessData),s=O(a=>a.setErrorData),{userData:r,setUserData:i}=p.useContext(V),u=h(a=>a.hasStore),l=h(a=>a.validApiKey),j=h(a=>a.hasApiKey),x=h(a=>a.loadingApiKey),{password:f,cnfPassword:$,profilePicture:q,apikey:B}=n,Q=he(a=>a.autoLogin),{storeApiKey:W}=p.useContext(V),L=h(a=>a.updateHasApiKey),F=h(a=>a.updateValidApiKey),T=h(a=>a.updateLoadingApiKey),{mutate:z}=ye(),{mutate:X}=je(),Z=()=>{if(f!==$){s({title:xe,list:[fe]});return}f!==""&&z({user_id:r.id,password:{password:f}},{onSuccess:()=>{g({target:{name:"password",value:""}}),g({target:{name:"cnfPassword",value:""}}),c({title:G})},onError:a=>{var d,m;s({title:H,list:[(m=(d=a==null?void 0:a.response)==null?void 0:d.data)==null?void 0:m.detail]})}})},J=Y(),ee=a=>{a!==""&&X({user_id:r.id,user:{profile_image:a}},{onSuccess:()=>{let d=ge.cloneDeep(r);d.profile_image=a,i(d),c({title:G})},onError:d=>{var m,U;s({title:H,list:[(U=(m=d==null?void 0:d.response)==null?void 0:m.data)==null?void 0:U.detail]})}})};we(t);const{mutate:se}=Pe({onSuccess:()=>{c({title:"API key saved successfully"}),L(!0),F(!0),T(!1),g({target:{name:"apikey",value:""}})},onError:a=>{var d,m;s({title:"API key save error",list:[(m=(d=a==null?void 0:a.response)==null?void 0:d.data)==null?void 0:m.detail]}),L(!1),F(!1),T(!1)}}),ae=a=>{a&&(se({key:a}),W(a))};function g({target:{name:a,value:d}}){o(m=>({...m,[a]:d}))}return e.jsxs("div",{className:"flex h-full w-full flex-col gap-6",children:[e.jsx(Ae,{}),e.jsxs("div",{className:"grid gap-6",children:[e.jsx(Ne,{profilePicture:q,handleInput:g,handlePatchProfilePicture:ee,handleGetProfilePictures:J,userData:r}),!Q&&e.jsx(Se,{password:f,cnfPassword:$,handleInput:g,handlePatchPassword:Z}),u&&e.jsx(Ce,{apikey:B,handleInput:g,handleSaveKey:ae,loadingApiKey:x,validApiKey:l,hasApiKey:j})]})]})};export{Ke as GeneralPage,Ke as default};
