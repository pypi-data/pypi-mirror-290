import{U as G,a as Y,g as Z,z as K,u as $,a8 as N,r as p,j as s,bF as J,c as Q,ci as ee,ad as te,B as F,dW as B,dX as ne,cD as re,dY as ae,I as L,dZ as se,d_ as oe,d$ as ie}from"./index-DugHs1zq.js";import{I as T}from"./input-BBLODMOP.js";import{L as R}from"./label-BZZvrSGa.js";import{C as le}from"./checkbox-Cp8Gj5nb.js";const ue=e=>{const{mutate:t}=G();return t(["usePatchUpdateFlow"],async l=>(await Y.patch(`${Z("FLOWS")}/${l.id}`,{name:l.name,data:l.data,description:l.description,folder_id:l.folder_id||null,endpoint_name:l.endpoint_name||null})).data,e)},de=()=>{const e=K(o=>o.flows),t=K(o=>o.setFlows),n=$(o=>o.setErrorData),a=N(o=>o.reactFlowInstance),l=N(o=>o.nodes),d=N(o=>o.edges),i=K(o=>o.setSaveLoading),m=N(o=>o.setCurrentFlow),h=K(o=>o.currentFlow),u=N(o=>o.currentFlow),y=u==null?void 0:u.data,{mutate:r}=ue();return async o=>(i(!0),new Promise((j,x)=>{var g;if(u&&(o=o||{...u,data:{...y,nodes:l,edges:d,viewport:(a==null?void 0:a.getViewport())??{zoom:1,x:0,y:0}}}),o&&o.data){const{id:v,name:f,data:w,description:c,folder_id:k,endpoint_name:A}=o;!((g=h==null?void 0:h.data)!=null&&g.nodes.length)||w.nodes.length>0?r({id:v,name:f,data:w,description:c,folder_id:k,endpoint_name:A},{onSuccess:C=>{i(!1),e?(t(e.map(I=>I.id===C.id?C:I)),m(C),j()):(n({title:"Failed to save flow",list:["Flows variable undefined"]}),x(new Error("Flows variable undefined")))},onError:C=>{n({title:"Failed to save flow",list:[C.message]}),i(!1),x(C)}}):(n({title:"Failed to save flow",list:["Can't save empty flow"]}),i(!1),x(new Error("Can't save empty flow")))}else n({title:"Failed to save flow",list:["Flow not found"]}),x(new Error("Flow not found"))}))},Ke=de;function D(){return D=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},D.apply(this,arguments)}var V=["shift","alt","meta","mod","ctrl"],ce={esc:"escape",return:"enter",".":"period",",":"comma","-":"slash"," ":"space","`":"backquote","#":"backslash","+":"bracketright",ShiftLeft:"shift",ShiftRight:"shift",AltLeft:"alt",AltRight:"alt",MetaLeft:"meta",MetaRight:"meta",OSLeft:"meta",OSRight:"meta",ControlLeft:"ctrl",ControlRight:"ctrl"};function b(e){return(ce[e]||e).trim().toLowerCase().replace(/key|digit|numpad|arrow/,"")}function fe(e){return V.includes(e)}function H(e,t){return t===void 0&&(t=","),e.split(t)}function P(e,t,n){t===void 0&&(t="+");var a=e.toLocaleLowerCase().split(t).map(function(i){return b(i)}),l={alt:a.includes("alt"),ctrl:a.includes("ctrl")||a.includes("control"),shift:a.includes("shift"),meta:a.includes("meta"),mod:a.includes("mod")},d=a.filter(function(i){return!V.includes(i)});return D({},l,{keys:d,description:n})}(function(){typeof document<"u"&&(document.addEventListener("keydown",function(e){e.key!==void 0&&q([b(e.key),b(e.code)])}),document.addEventListener("keyup",function(e){e.key!==void 0&&z([b(e.key),b(e.code)])})),typeof window<"u"&&window.addEventListener("blur",function(){S.clear()})})();var S=new Set;function M(e){return Array.isArray(e)}function me(e,t){t===void 0&&(t=",");var n=M(e)?e:e.split(t);return n.every(function(a){return S.has(a.trim().toLowerCase())})}function q(e){var t=Array.isArray(e)?e:[e];S.has("meta")&&S.forEach(function(n){return!fe(n)&&S.delete(n.toLowerCase())}),t.forEach(function(n){return S.add(n.toLowerCase())})}function z(e){var t=Array.isArray(e)?e:[e];e==="meta"?S.clear():t.forEach(function(n){return S.delete(n.toLowerCase())})}function pe(e,t,n){(typeof n=="function"&&n(e,t)||n===!0)&&e.preventDefault()}function he(e,t,n){return typeof n=="function"?n(e,t):n===!0||n===void 0}function ve(e){return W(e,["input","textarea","select"])}function W(e,t){var n=e.target;t===void 0&&(t=!1);var a=n&&n.tagName;return M(t)?!!(a&&t&&t.some(function(l){return l.toLowerCase()===a.toLowerCase()})):!!(a&&t&&t===!0)}function ye(e,t){return e.length===0&&t?(console.warn('A hotkey has the "scopes" option set, however no active scopes were found. If you want to use the global scopes feature, you need to wrap your app in a <HotkeysProvider>'),!0):t?e.some(function(n){return t.includes(n)})||e.includes("*"):!0}var we=function(t,n,a){a===void 0&&(a=!1);var l=n.alt,d=n.meta,i=n.mod,m=n.shift,h=n.ctrl,u=n.keys,y=t.key,r=t.code,E=t.ctrlKey,o=t.metaKey,j=t.shiftKey,x=t.altKey,g=b(r),v=y.toLowerCase();if(!(u!=null&&u.includes(g))&&!(u!=null&&u.includes(v))&&!["ctrl","control","unknown","meta","alt","shift","os"].includes(g))return!1;if(!a){if(l===!x&&v!=="alt"||m===!j&&v!=="shift")return!1;if(i){if(!o&&!E)return!1}else if(d===!o&&v!=="meta"&&v!=="os"||h===!E&&v!=="ctrl"&&v!=="control")return!1}return u&&u.length===1&&(u.includes(v)||u.includes(g))?!0:u?me(u):!u},xe=p.createContext(void 0),ge=function(){return p.useContext(xe)};function X(e,t){return e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(e).length===Object.keys(t).length&&Object.keys(e).reduce(function(n,a){return n&&X(e[a],t[a])},!0):e===t}var Ce=p.createContext({hotkeys:[],enabledScopes:[],toggleScope:function(){},enableScope:function(){},disableScope:function(){}}),Ee=function(){return p.useContext(Ce)};function je(e){var t=p.useRef(void 0);return X(t.current,e)||(t.current=e),t.current}var U=function(t){t.stopPropagation(),t.preventDefault(),t.stopImmediatePropagation()},ke=typeof window<"u"?p.useLayoutEffect:p.useEffect;function Re(e,t,n,a){var l=p.useRef(null),d=p.useRef(!1),i=n instanceof Array?a instanceof Array?void 0:a:n,m=M(e)?e.join(i==null?void 0:i.splitKey):e,h=n instanceof Array?n:a instanceof Array?a:void 0,u=p.useCallback(t,h??[]),y=p.useRef(u);h?y.current=u:y.current=t;var r=je(i),E=Ee(),o=E.enabledScopes,j=ge();return ke(function(){if(!((r==null?void 0:r.enabled)===!1||!ye(o,r==null?void 0:r.scopes))){var x=function(c,k){var A;if(k===void 0&&(k=!1),!(ve(c)&&!W(c,r==null?void 0:r.enableOnFormTags))){if(l.current!==null){var C=l.current.getRootNode();if((C instanceof Document||C instanceof ShadowRoot)&&C.activeElement!==l.current&&!l.current.contains(C.activeElement)){U(c);return}}(A=c.target)!=null&&A.isContentEditable&&!(r!=null&&r.enableOnContentEditable)||H(m,r==null?void 0:r.splitKey).forEach(function(I){var O,_=P(I,r==null?void 0:r.combinationKey);if(we(c,_,r==null?void 0:r.ignoreModifiers)||(O=_.keys)!=null&&O.includes("*")){if(r!=null&&r.ignoreEventWhen!=null&&r.ignoreEventWhen(c)||k&&d.current)return;if(pe(c,_,r==null?void 0:r.preventDefault),!he(c,_,r==null?void 0:r.enabled)){U(c);return}y.current(c,_),k||(d.current=!0)}})}},g=function(c){c.key!==void 0&&(q(b(c.code)),((r==null?void 0:r.keydown)===void 0&&(r==null?void 0:r.keyup)!==!0||r!=null&&r.keydown)&&x(c))},v=function(c){c.key!==void 0&&(z(b(c.code)),d.current=!1,r!=null&&r.keyup&&x(c,!0))},f=l.current||(i==null?void 0:i.document)||document;return f.addEventListener("keyup",v),f.addEventListener("keydown",g),j&&H(m,r==null?void 0:r.splitKey).forEach(function(w){return j.addHotkey(P(w,r==null?void 0:r.combinationKey,r==null?void 0:r.description))}),function(){f.removeEventListener("keyup",v),f.removeEventListener("keydown",g),j&&H(m,r==null?void 0:r.splitKey).forEach(function(w){return j.removeHotkey(P(w,r==null?void 0:r.combinationKey,r==null?void 0:r.description))})}}},[m,r,o]),l}const be=({name:e,invalidNameList:t=[],description:n,endpointName:a,maxLength:l=50,setName:d,setDescription:i,setEndpointName:m})=>{const[h,u]=p.useState(!1),[y,r]=p.useState(!0),[E,o]=p.useState(!1),j=f=>{const{value:w}=f.target;w.length>=l?u(!0):u(!1);let c=!1;for(let k=0;k<t.length;k++){if(w===t[k]){c=!0;break}c=!1}o(c),d(w)},x=f=>{i(f.target.value)},g=f=>{const w=ee(f.target.value,l);r(w),m(f.target.value)},v=f=>f.target.select();return s.jsxs(s.Fragment,{children:[s.jsxs(R,{children:[s.jsxs("div",{className:"edit-flow-arrangement",children:[s.jsxs("span",{className:"font-medium",children:["Name",d?"":":"]})," ",h&&s.jsx("span",{className:"edit-flow-span",children:"Character limit reached"}),E&&s.jsx("span",{className:"edit-flow-span",children:"Invalid name"})]}),d?s.jsx(T,{className:"nopan nodelete nodrag noflow mt-2 font-normal",onChange:j,type:"text",name:"name",value:e??"",placeholder:"Flow name",id:"name",maxLength:l,onDoubleClickCapture:f=>{v(f)}}):s.jsx("span",{className:"font-normal text-muted-foreground word-break-break-word",children:e})]}),s.jsxs(R,{children:[s.jsx("div",{className:"edit-flow-arrangement mt-3",children:s.jsxs("span",{className:"font-medium",children:["Description",i?" (optional)":":"]})}),i?s.jsx(J,{name:"description",id:"description",onChange:x,value:n,placeholder:"Flow description",className:"mt-2 max-h-[250px] resize-none font-normal",rows:5,onDoubleClickCapture:f=>{v(f)}}):s.jsx("div",{className:Q("max-h-[250px] overflow-auto pt-2 font-normal text-muted-foreground word-break-break-word",n===""?"font-light italic":""),children:n===""?"No description":n})]}),m&&s.jsxs(R,{children:[s.jsxs("div",{className:"edit-flow-arrangement mt-3",children:[s.jsx("span",{className:"font-medium",children:"Endpoint Name"}),!y&&s.jsxs("span",{className:"edit-flow-span",children:["Invalid endpoint name. Use only letters, numbers, hyphens, and underscores (",l," characters max)."]})]}),s.jsx(T,{className:"nopan nodelete nodrag noflow mt-2 font-normal",onChange:g,type:"text",name:"endpoint_name",value:a??"",placeholder:"An alternative name to run the endpoint",maxLength:l,id:"endpoint_name",onDoubleClickCapture:f=>{v(f)}})]})]})},Se=be,Ne=p.forwardRef((e,t)=>{const n=te(o=>o.version),a=$(o=>o.setNoticeData),[l,d]=p.useState(!1),i=N(o=>o.currentFlow);p.useEffect(()=>{h(i.name),y(i.description)},[i.name,i.description]);const[m,h]=p.useState(i.name),[u,y]=p.useState(i.description),[r,E]=p.useState(!1);return s.jsxs(F,{size:"smaller-h-full",open:r,setOpen:E,onSubmit:()=>{l?(B({id:i.id,data:i.data,description:u,name:m,last_tested_version:n,endpoint_name:i.endpoint_name,is_component:!1},m,u),a({title:ne})):B(re({id:i.id,data:i.data,description:u,name:m,last_tested_version:n,endpoint_name:i.endpoint_name,is_component:!1}),m,u),E(!1)},children:[s.jsx(F.Trigger,{asChild:!0,children:e.children}),s.jsxs(F.Header,{description:ae,children:[s.jsx("span",{className:"pr-2",children:"Export"}),s.jsx(L,{name:"Download",className:"h-6 w-6 pl-1 text-foreground","aria-hidden":"true"})]}),s.jsxs(F.Content,{children:[s.jsx(Se,{name:m,description:u,setName:h,setDescription:y}),s.jsxs("div",{className:"mt-3 flex items-center space-x-2",children:[s.jsx(le,{id:"terms",checked:l,onCheckedChange:o=>{d(o)}}),s.jsx("label",{htmlFor:"terms",className:"export-modal-save-api text-sm",children:se})]}),s.jsx("span",{className:"mt-1 text-xs text-destructive",children:oe})]}),s.jsx(F.Footer,{submit:{label:"Export"}})]})}),He=Ne;function _e({isMac:e,hasShift:t,filteredShortcut:n,shortcutWPlus:a}){return t?s.jsxs("span",{className:"flex items-center justify-center gap-0.5 text-xs",children:[e?s.jsx(L,{name:"Command",className:"h-3 w-3"}):n[0],s.jsx(L,{name:"ArrowBigUp",className:"h-4 w-4"}),n.map((l,d)=>d>0?l.toUpperCase():null)]}):s.jsxs("span",{className:"flex items-center justify-center gap-0.5 text-xs",children:[a[0].toLowerCase()==="space"?"Space":a[0].length<=1?a[0]:e?s.jsx(L,{name:"Command",className:"h-3 w-3"}):s.jsx("span",{className:"flex items-center",children:a[0]}),a.map((l,d)=>d>0?s.jsx("span",{className:"flex items-center",children:l.toUpperCase()},d):null)]})}function Pe({value:e,icon:t,style:n,dataTestId:a,ping:l,shortcut:d}){let i=!1;const m=d==null?void 0:d.split("+");m.forEach(y=>{y.toLowerCase().includes("shift")&&(i=!0)});const h=m.filter(y=>!y.toLowerCase().includes("shift"));let u=[];return i||(u=h.join("+").split(" ")),s.jsxs("div",{className:`flex ${n}`,"data-testid":a,children:[s.jsx(L,{name:t,className:`mr-2 ${t==="Share3"?"absolute left-2 top-[0.25em] h-6 w-6":"mt-[0.15em] h-4 w-4"} ${l&&"animate-pulse text-green-500"}`}),s.jsx("span",{className:`${t==="Share3"?"ml-[1.8em]":" "}`,children:e}),s.jsx("span",{className:"absolute right-2 top-[0.43em] flex items-center rounded-sm bg-muted px-1.5 py-[0.1em] text-muted-foreground",children:s.jsx(_e,{isMac:ie,hasShift:i,filteredShortcut:h,shortcutWPlus:u})})]})}export{Se as E,_e as R,Pe as T,Ke as a,He as b,Re as u};
