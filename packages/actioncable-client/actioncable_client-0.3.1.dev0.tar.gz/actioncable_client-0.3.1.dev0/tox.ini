[tox]
min_version = 4.0
env_list =
    py312
    py311
    py310
    py39
    type
    report

[tool:pytest]
testpaths = tests

[testenv]
setenv =
    py{312,311,310,39}: COVERAGE_FILE = .coverage.{envname}
    py{312,311,310,39}: JUNIT_FILE = .report.{envname}.xml
deps =
    pytest
    pytest-cov
    pytest-mock
    callee
commands = pytest --cov actioncable_client --junitxml=$JUNIT_FILE --cov-report=
depends =
    report: py312,py311,py310,py39

[testenv:type]
deps =
  mypy
  types-requests
commands = mypy src

[testenv:report]
skip_install = true
deps =
    coverage
    junitparser
commands =
    coverage combine
    coverage xml
    coverage report --fail-under=10
    junitparser merge .report.py312.xml .report.py311.xml .report.py310.xml .report.py39.xml report.xml
