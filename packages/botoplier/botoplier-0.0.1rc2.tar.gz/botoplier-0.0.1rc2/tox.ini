[tox]
requires =
    tox>=4.2
env_list =
    clean
    report
    py{312, 311, 310, 39}

[testenv]
set_env =
    py{39,310,311,312}: COVERAGE_FILE = .coverage.{envname}
commands =
    pytest --cov --cov-append --cov-report=term-missing {posargs:-vv} --cov-config=pyproject.toml
allowlist_externals =
    coverage
    pdm
    pytest
depends =
    report: py{312, 311, 310, 39}
    py{312, 311, 310, 39}: clean
groups =
    dev

[testenv:clean]
skip_install = true
commands =
    coverage erase
groups =
    dev

[testenv:report]
skip_install = true
commands =
    coverage combine
    coverage report
    coverage html
    coverage xml

[testenv:py{39,310,311,312}]
package = editable

[gh]
python =
    3.9= py39, report, clean
    3.10= py310, report, clean
    3.11= py311, report, clean
    3.12= py312, report, clean
fail_on_no_env = True
