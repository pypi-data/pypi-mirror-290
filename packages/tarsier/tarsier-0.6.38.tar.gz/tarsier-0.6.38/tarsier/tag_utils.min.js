"use strict";const tarsierId="__tarsier_id",tarsierDataAttribute="data-tarsier-id",tarsierSelector=`#${tarsierId}`,reworkdVisibilityAttribute="reworkd-original-visibility",elIsVisible=t=>{const i=t.getBoundingClientRect(),e=window.getComputedStyle(t),o=e.visibility==="hidden"||e.display==="none"||t.hidden||t.hasAttribute("disabled")&&t.getAttribute("disabled"),r=e.opacity==="0"&&!hasLabel(t),n=e.display==="contents",a=(i.width===0||i.height===0)&&!n,l=t.tagName==="SCRIPT"||t.tagName==="STYLE";return!o&&!r&&!a&&!l};function hasLabel(t){if(!["input","textarea","select","button"].includes(t.tagName.toLowerCase()))return!1;const e=CSS.escape(t.id);if(document.querySelector(`label[for="${e}"]`))return!0;const s=Array.from(t.parentElement?.children||[]);for(let r of s)if(r.tagName.toLowerCase()==="label")return!0;return!1}const isNonWhiteSpaceTextNode=t=>t.nodeType===Node.TEXT_NODE&&t.textContent&&t.textContent.trim().length>0&&t.textContent.trim()!=="\u200B",inputs=["a","button","textarea","select","details","label"],isInteractable=t=>t.tagName.toLowerCase()==="label"&&t.querySelector("input")?!1:inputs.includes(t.tagName.toLowerCase())||t.tagName.toLowerCase()==="input"&&t.type!=="hidden"||t.role==="button",text_input_types=["text","password","email","search","url","tel","number"],isTextInsertable=t=>t.tagName.toLowerCase()==="textarea"||t.tagName.toLowerCase()==="input"&&text_input_types.includes(t.type),textLessTagWhiteList=["input","textarea","select","button","a"],isTextLess=t=>{const i=t.tagName.toLowerCase();if(textLessTagWhiteList.includes(i)||t.childElementCount>0)return!1;if("innerText"in t&&t.innerText.trim().length===0){const e=t.querySelector("svg"),o=t.querySelector("img");return e||o?!1:isElementInViewport(t)}return!1};function isElementInViewport(t){const i=t.getBoundingClientRect(),e=i.width>1||i.height>1;let o=document.body,s=document.documentElement;const r=Math.max(o.scrollHeight,o.offsetHeight,s.clientHeight,s.scrollHeight,s.offsetHeight),n=Math.max(o.scrollWidth,o.offsetWidth,s.clientWidth,s.scrollWidth,s.offsetWidth);return e&&i.top>=0&&i.left>=0&&i.bottom<=r&&i.right<=n}function getElementXPath(t){let i=[],e="";for(t&&t.ownerDocument!==window.document&&(e=`iframe[${t.getAttribute("iframe_index")}]`);t;){if(!t.tagName){t=t.parentNode;continue}let o=t.tagName.toLowerCase(),s=window.fixNamespaces(o),r=1,n=t.previousElementSibling;for(;n;)n.tagName===t.tagName&&n.id!=tarsierId&&r++,n=n.previousElementSibling;let a=t.nextElementSibling,l=!1;for(;a;){if(a.tagName===t.tagName){l=!0;break}a=a.nextElementSibling}if((r>1||l)&&(s+=`[${r}]`),t.id){if(s+=`[@id="${t.id}"]`,i.length>3)return i.unshift(s),"//"+i.join("/")}else t.className&&(s+=`[@class="${t.className}"]`);i.unshift(s),t=t.parentNode}return e+"//"+i.join("/")}function create_tagged_span(t,i){let e;isInteractable(i)?isTextInsertable(i)?e=`[#${t}]`:i.tagName.toLowerCase()=="a"?e=`[@${t}]`:e=`[$${t}]`:e=`[${t}]`;let o=document.createElement("span");return o.id=tarsierId,o.style.position="relative",o.style.display="inline",o.style.color="white",o.style.backgroundColor="red",o.style.padding="1.5px",o.style.borderRadius="3px",o.style.fontWeight="bold",o.style.fontFamily="Arial",o.style.margin="1px",o.style.lineHeight="1.25",o.style.letterSpacing="2px",o.style.zIndex="2140000046",o.style.clip="auto",o.style.height="fit-content",o.style.width="fit-content",o.style.minHeight="15px",o.style.minWidth="23px",o.style.maxHeight="unset",o.style.maxWidth="unset",o.textContent=e,o.style.webkitTextFillColor="white",o.style.textShadow="",o.style.textDecoration="none",o.style.letterSpacing="0px",o.setAttribute(tarsierDataAttribute,t.toString()),o}const MIN_FONT_SIZE=11,ensureMinimumTagFontSizes=()=>{Array.from(document.querySelectorAll(tarsierSelector)).forEach(i=>{parseFloat(window.getComputedStyle(i).fontSize.split("px")[0])<MIN_FONT_SIZE&&(i.style.fontSize=`${MIN_FONT_SIZE}px`)})};window.tagifyWebpage=(t=!1)=>{window.removeTags(),hideMapElements();const i=getAllElementsInAllFrames(),e=getElementsToTag(i,t),o=removeNestedTags(e),s=insertTags(o,t);return shrinkCollidingTags(),ensureMinimumTagFontSizes(),Object.entries(s).reduce((r,[n,a])=>(r[parseInt(n)]=a.xpath,r),{})};function getAllElementsInAllFrames(){const t=Array.from(document.body.querySelectorAll("*")),i=document.getElementsByTagName("iframe");for(let e=0;e<i.length;e++)try{const o=i[e],s=o.contentDocument||o.contentWindow?.document;if(!s)continue;const r=Array.from(s.querySelectorAll("*"));r.forEach(n=>n.setAttribute("iframe_index",e.toString())),t.push(...r)}catch(o){console.error("Error accessing iframe content:",o)}return t}function getElementsToTag(t,i){const e=[];for(let o of t)isTextLess(o)||!elIsVisible(o)||(isInteractable(o)||i&&Array.from(o.childNodes).filter(isNonWhiteSpaceTextNode).length>=1)&&e.push(o);return e}function removeNestedTags(t){const i=[...t];return t.map(e=>{if(isInteractable(e)){const o=[];if(e.querySelectorAll("*").forEach(s=>{i.indexOf(s)>-1&&o.push(s)}),o.length<=2)for(let s of o)i.splice(i.indexOf(s),1)}}),i}function insertTags(t,i){function e(n){if(!n.firstChild||n.firstChild.nodeType!==Node.TEXT_NODE)return;const a=n.firstChild;a.textContent=a.textContent.trimStart()}function o(n,a){const l=Array.from(n.childNodes).filter(c=>isNonWhiteSpaceTextNode(c)?!0:c.nodeType===Node.TEXT_NODE?!1:!(c.nodeType===Node.ELEMENT_NODE&&(isTextLess(c)||!elIsVisible(c))));if(l.length===1){const c=l[0],d=["div","span","p","h1","h2","h3","h4","h5","h6"];if(c.nodeType===Node.ELEMENT_NODE&&d.includes(c.tagName.toLowerCase()))return o(c,a)}return e(n),n}const s={};let r=0;for(let n of t)if(s[r]={xpath:getElementXPath(n)},isInteractable(n)){const a=create_tagged_span(r,n);if(isTextInsertable(n)&&n.parentElement)n.parentElement.insertBefore(a,n);else{const l=o(n,a);l.prepend(a),absolutelyPositionTagIfMisaligned(a,l)}r++}else if(i){e(n);const a=Array.from(n.childNodes).filter(isNonWhiteSpaceTextNode),l=Array.from(n.childNodes).filter(c=>c.nodeType===Node.TEXT_NODE);for(let c of a){const d=getElementXPath(n),g=l.indexOf(c)+1;s[r]={xpath:d,textNodeIndex:g};const p=create_tagged_span(r,n);n.insertBefore(p,c),r++}}return s}function absolutelyPositionTagIfMisaligned(t,i){let e=t.getBoundingClientRect();if(!(e.width===0||e.height===0))return;const o=250,s=i.getBoundingClientRect();if(s.right<0||s.left>(window.innerWidth||document.documentElement.clientWidth)){t.remove();return}const r={x:s.left,y:s.top},n={x:(e.left+e.right)/2,y:(e.top+e.bottom)/2},a=Math.abs(r.x-n.x),l=Math.abs(r.y-n.y);if(a>o||l>o||!elIsVisible(t)){t.style.position="absolute";let c=Math.max(0,s.left-(e.right+3-e.left));c=Math.min(c,window.innerWidth-(e.right-e.left));let d=Math.max(0,s.top+3);d=Math.min(d,Math.max(window.innerHeight,document.documentElement.scrollHeight)-(e.bottom-e.top)),t.style.left=`${c}px`,t.style.top=`${d}px`,t.parentElement&&t.parentElement.removeChild(t),document.body.appendChild(t)}}const shrinkCollidingTags=()=>{const t=Array.from(document.querySelectorAll(tarsierSelector));for(let i=0;i<t.length;i++){const e=t[i];let o=e.getBoundingClientRect(),s=parseFloat(window.getComputedStyle(e).fontSize.split("px")[0]);for(let r=i+1;r<t.length;r++){const n=t[r];let a=n.getBoundingClientRect(),l=parseFloat(window.getComputedStyle(n).fontSize.split("px")[0]);for(;o.left<a.right&&o.right>a.left&&o.top<a.bottom&&o.bottom>a.top&&s>MIN_FONT_SIZE&&l>MIN_FONT_SIZE;)s-=.5,l-=.5,e.style.fontSize=`${s}px`,n.style.fontSize=`${l}px`,o=e.getBoundingClientRect(),a=n.getBoundingClientRect()}}};window.removeTags=()=>{document.querySelectorAll(tarsierSelector).forEach(i=>i.remove()),showMapElements()};const GOOGLE_MAPS_OPACITY_CONTROL="__reworkd_google_maps_opacity",hideMapElements=()=>{const t=['iframe[src*="google.com/maps"]','iframe[id*="gmap_canvas"]',".maplibregl-map",".mapboxgl-map",".leaflet-container",'img[src*="maps.googleapis.com"]','[aria-label="Map"]',".cmp-location-map__map",'.map-view[data-role="mapView"]',".google_Map-wrapper",".google_map-wrapper",".googleMap-wrapper",".googlemap-wrapper",".ls-map-canvas",".gmapcluster","#googleMap","#googleMaps","#googlemaps","#googlemap","#google_map","#google_maps","#MapId",".geolocation-map-wrapper",".locatorMap"];document.querySelectorAll(t.join(", ")).forEach(i=>{const e=window.getComputedStyle(i).opacity;i.setAttribute("data-original-opacity",e),i.style.opacity="0"})},showMapElements=()=>{document.querySelectorAll(`[${GOOGLE_MAPS_OPACITY_CONTROL}]`).forEach(i=>{i.style.opacity=i.getAttribute("data-original-opacity")||"1"})};window.hideNonTagElements=()=>{getAllElementsInAllFrames().forEach(i=>{const e=i;e.style.visibility&&e.setAttribute(reworkdVisibilityAttribute,e.style.visibility),e.id.startsWith(tarsierId)?e.style.visibility="visible":e.style.visibility="hidden"})},window.fixNamespaces=t=>{const i=/^[a-zA-Z_][\w\-.]*:[a-zA-Z_][\w\-.]*$/,e=t.split(/[#.]/)[0];return i.test(e)?t.replace(e,`*[name()="${e}"]`):t},window.revertVisibilities=()=>{getAllElementsInAllFrames().forEach(i=>{const e=i;e.getAttribute(reworkdVisibilityAttribute)?e.style.visibility=e.getAttribute(reworkdVisibilityAttribute)||"true":e.style.removeProperty("visibility")})};
