"use strict";const tarsierId="__tarsier_id",tarsierDataAttribute="data-tarsier-id",tarsierSelector=`#${tarsierId}`,reworkdVisibilityAttr="reworkd-original-visibility",elIsVisible=t=>{const o=t.getBoundingClientRect(),n=window.getComputedStyle(t),e=n.visibility==="hidden"||n.display==="none"||t.hidden||t.hasAttribute("disabled")&&t.getAttribute("disabled"),s=n.opacity==="0"&&!hasLabel(t),l=o.width===0||o.height===0,a=t.tagName==="SCRIPT"||t.tagName==="STYLE";return!e&&!s&&!l&&!a};function hasLabel(t){if(!["input","textarea","select","button"].includes(t.tagName.toLowerCase()))return!1;const n=CSS.escape(t.id);if(document.querySelector(`label[for="${n}"]`))return!0;const i=Array.from(t.parentElement?.children||[]);for(let s of i)if(s.tagName.toLowerCase()==="label")return!0;return!1}const isNonWhiteSpaceTextNode=t=>t.nodeType===Node.TEXT_NODE&&t.textContent&&t.textContent.trim().length>0&&t.textContent.trim()!=="\u200B",inputs=["a","button","textarea","select","details","label"],isInteractable=t=>t.tagName.toLowerCase()==="label"&&t.querySelector("input")?!1:inputs.includes(t.tagName.toLowerCase())||t.tagName.toLowerCase()==="input"&&t.type!=="hidden"||t.role==="button",text_input_types=["text","password","email","search","url","tel","number"],isTextInsertable=t=>t.tagName.toLowerCase()==="textarea"||t.tagName.toLowerCase()==="input"&&text_input_types.includes(t.type),textLessTagWhiteList=["input","textarea","select","button"],isTextLess=t=>{const o=t.tagName.toLowerCase();if(textLessTagWhiteList.includes(o)||t.childElementCount>0)return!1;if("innerText"in t&&t.innerText.trim().length===0){const n=t.querySelector("svg"),e=t.querySelector("img");return n||e?!1:isElementInViewport(t)}return!1};function isElementInViewport(t){const o=t.getBoundingClientRect();return o.top>=0&&o.left>=0&&o.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&o.right<=(window.innerWidth||document.documentElement.clientWidth)}function getElementXPath(t){let o=[],n="";for(t&&t.ownerDocument!==window.document&&(n=`iframe[${t.getAttribute("iframe_index")}]`);t;){if(!t.tagName){t=t.parentNode;continue}let e=t.tagName.toLowerCase(),i=window.fixNamespaces(e),s=1,l=t.previousElementSibling;for(;l;)l.tagName===t.tagName&&s++,l=l.previousElementSibling;let a=t.nextElementSibling,c=!1;for(;a;){if(a.tagName===t.tagName){c=!0;break}a=a.nextElementSibling}if((s>1||c)&&(i+=`[${s}]`),t.id){if(i+=`[@id="${t.id}"]`,o.length>3)return o.unshift(i),"//"+o.join("/")}else t.className&&(i+=`[@class="${t.className}"]`);o.unshift(i),t=t.parentNode}return n+"//"+o.join("/")}function create_tagged_span(t,o){let n;isInteractable(o)?isTextInsertable(o)?n=`[#${t}]`:o.tagName.toLowerCase()=="a"?n=`[@${t}]`:n=`[$${t}]`:n=`[${t}]`;let e=document.createElement("span");return e.id=tarsierId,e.style.position="relative",e.style.display="inline",e.style.color="white",e.style.backgroundColor="red",e.style.padding="1.5px",e.style.borderRadius="3px",e.style.fontWeight="bold",e.style.fontFamily="Arial",e.style.margin="1px",e.style.lineHeight="1.25",e.style.letterSpacing="2px",e.style.zIndex="2140000046",e.style.clip="auto",e.style.height="fit-content",e.style.width="fit-content",e.style.minHeight="fit-content",e.style.minWidth="fit-content",e.style.maxHeight="unset",e.style.maxWidth="unset",e.textContent=n,e.style.webkitTextFillColor="white",e.style.textShadow="",e.style.textDecoration="none",e.style.letterSpacing="0px",e.setAttribute(tarsierDataAttribute,t.toString()),e}window.tagifyWebpage=(t=!1)=>{window.removeTags(),hideMapElements();const o=getAllElementsInAllFrames(),n=getElementsToTag(o,t),e=removeNestedTags(n),i=insertTags(e,t);return absolutelyPositionMissingTags(i),i};function getAllElementsInAllFrames(){const t=Array.from(document.body.querySelectorAll("*")),o=document.getElementsByTagName("iframe");for(let n=0;n<o.length;n++)try{const e=o[n],i=e.contentDocument||e.contentWindow?.document;if(!i)continue;const s=Array.from(i.querySelectorAll("*"));s.forEach(l=>l.setAttribute("iframe_index",n.toString())),t.push(...s)}catch(e){console.error("Error accessing iframe content:",e)}return t}function getElementsToTag(t,o){const n=[];for(let e of t)isTextLess(e)||!elIsVisible(e)||(isInteractable(e)||o&&Array.from(e.childNodes).filter(isNonWhiteSpaceTextNode).length>=1)&&n.push(e);return n}function removeNestedTags(t){const o=[...t];return t.map(n=>{if(isInteractable(n)){const e=[];if(n.querySelectorAll("*").forEach(i=>{o.indexOf(i)>-1&&e.push(i)}),e.length==1)for(let i of e)o.splice(o.indexOf(i),1)}}),o}function insertTags(t,o){const n={};let e=0;for(let i of t)if(n[e]=getElementXPath(i),isInteractable(i)){const s=create_tagged_span(e,i);isTextInsertable(i)&&i.parentElement?i.parentElement.insertBefore(s,i):i.prepend(s),e++}else if(o){const s=Array.from(i.childNodes).filter(isNonWhiteSpaceTextNode);for(let l of s){const a=getElementXPath(i),c=s.indexOf(l)+1;n[e]=`${a}/text()`,s.length>1&&(n[e]=`(${a}/text())[${c}]`);const r=create_tagged_span(e,i);i.insertBefore(r,l),e++}}return n}function absolutelyPositionMissingTags(t){const n=document.querySelectorAll(tarsierSelector);n.forEach(e=>{const i=e.parentElement,s=parseInt(e.getAttribute(tarsierDataAttribute)||"-1"),l=t[s],a=document.evaluate(l,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(!a){console.error("Reference node not found for tag",e,"with XPath",l);return}let c=null;if(a.nodeType===Node.TEXT_NODE){const d=document.createRange();d.selectNodeContents(a),c=d.getBoundingClientRect()}else a.nodeType===Node.ELEMENT_NODE&&(c=a.getBoundingClientRect());if(!c){console.error("Could not get bounding client rect for reference node",a);return}let r=e.getBoundingClientRect();const f={x:(c.left+c.right)/2,y:(c.top+c.bottom)/2},m={x:(r.left+r.right)/2,y:(r.top+r.bottom)/2},y=Math.abs(f.x-m.x),h=Math.abs(f.y-m.y);if(y>500||h>500||!elIsVisible(e)){e.style.position="absolute";let d=Math.max(0,c.left-(r.right+3-r.left));d=Math.min(d,window.innerWidth-(r.right-r.left));let p=Math.max(0,c.top+3);p=Math.min(p,Math.max(window.innerHeight,document.documentElement.scrollHeight)-(r.bottom-r.top)),e.style.left=`${d}px`,e.style.top=`${p}px`,i.removeChild(e),document.body.appendChild(e)}n.forEach(d=>{if(e===d)return;let p=d.getBoundingClientRect(),u=parseFloat(window.getComputedStyle(e).fontSize.split("px")[0]),g=parseFloat(window.getComputedStyle(d).fontSize.split("px")[0]);for(;r.left<p.right&&r.right>p.left&&r.top<p.bottom&&r.bottom>p.top&&u>7&&g>7;)u-=.5,g-=.5,e.style.fontSize=`${u}px`,d.style.fontSize=`${g}px`,r=e.getBoundingClientRect(),p=d.getBoundingClientRect()})})}window.removeTags=()=>{document.querySelectorAll(tarsierSelector).forEach(o=>o.remove()),showMapElements()};const GOOGLE_MAPS_OPACITY_CONTROL="__reworkd_google_maps_opacity",hideMapElements=()=>{const t=['iframe[src*="google.com/maps"]','iframe[id*="gmap_canvas"]',".maplibregl-map",".mapboxgl-map",".leaflet-container",'img[src*="maps.googleapis.com"]','[aria-label="Map"]',".cmp-location-map__map",'.map-view[data-role="mapView"]',".google_Map-wrapper",".google_map-wrapper",".googleMap-wrapper",".googlemap-wrapper",".ls-map-canvas",".gmapcluster","#googleMap","#googleMaps","#googlemaps","#googlemap","#google_map","#google_maps","#MapId",".geolocation-map-wrapper",".locatorMap"];document.querySelectorAll(t.join(", ")).forEach(o=>{const n=window.getComputedStyle(o).opacity;o.setAttribute("data-original-opacity",n),o.style.opacity="0"})},showMapElements=()=>{document.querySelectorAll(`[${GOOGLE_MAPS_OPACITY_CONTROL}]`).forEach(o=>{o.style.opacity=o.getAttribute("data-original-opacity")||"1"})};window.hideNonTagElements=()=>{getAllElementsInAllFrames().forEach(o=>{const n=o;n.style.visibility&&n.setAttribute(reworkdVisibilityAttr,n.style.visibility),n.id.startsWith(tarsierId)?n.style.visibility="visible":n.style.visibility="hidden"})},window.fixNamespaces=t=>{const o=/^[a-zA-Z_][\w\-.]*:[a-zA-Z_][\w\-.]*$/,n=t.split(/[#.]/)[0];return o.test(n)?t.replace(n,`*[name()="${n}"]`):t},window.revertVisibilities=()=>{getAllElementsInAllFrames().forEach(o=>{const n=o;n.getAttribute(reworkdVisibilityAttr)?n.style.visibility=n.getAttribute(reworkdVisibilityAttr)||"true":n.style.removeProperty("visibility")})};
