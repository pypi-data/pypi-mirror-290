"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[3784],{93784:(e,t,a)=>{a.r(t),a.d(t,{default:()=>d});var r=a(96540),l=a(58863),n=a(96627),s=a(7349),u=a(32142),i=a(86444),o=a(85867),c=a(71194),h=a(2445);function d({height:e,width:t,echartOptions:a,setDataMask:d,labelMap:p,labelMapB:f,groupby:g,groupbyB:m,selectedValues:b,formData:v,emitCrossFilters:y,seriesBreakdown:w,onContextMenu:k,onFocusedSeries:F,xValueFormatter:x,xAxis:C,refs:E,coltypeMapping:V}){const I=(0,r.useCallback)((e=>e<w),[w]),M=(0,r.useCallback)(((e,t)=>{const a=Object.values(b||{});let r;r=a.includes(e)?a.filter((t=>t!==e)):[e];const l=I(t)?g:m,n=I(t)?p:f,s=r.map((e=>null==n?void 0:n[e])).filter((e=>!!e));return{dataMask:{extraFormData:{filters:0===r.length?[]:[...l.map(((e,t)=>{const a=s.map((e=>e[t]));return null==a?{col:e,op:"IS NULL"}:{col:e,op:"IN",val:a}}))]},filterState:{value:s.length?s:null,selectedValues:r.length?r:null}},isCurrentValueSelected:a.includes(e)}}),[g,m,I,p,f,b]),N=(0,r.useCallback)(((e,t)=>{y&&d(M(e,t).dataMask)}),[y,d,M]),O={click:e=>{const{seriesName:t,seriesIndex:a}=e;N(t,a)},mouseout:()=>{F(null)},mouseover:e=>{F(e.seriesName)},contextmenu:async e=>{if(k){e.event.stop();const{data:t,seriesName:a,seriesIndex:r}=e,o=e.event.event,h=[],d=[],g=I(r),m=[...e.name?[e.name]:[],...(g?p:f)[e.seriesName]];t&&C.type===l.Gw.Time&&h.push({col:C.label===n.Tf?v.granularitySqla:C.label,grain:v.timeGrainSqla,op:"==",val:t[0],formattedVal:x(t[0])}),[...t&&C.type===l.Gw.Category?[C.label]:[],...g?v.groupby:v.groupbyB].forEach(((e,t)=>h.push({col:e,op:"==",val:m[t],formattedVal:String(m[t])}))),[...g?v.groupby:v.groupbyB].forEach(((e,t)=>d.push({col:e,op:"==",val:m[t],formattedVal:(0,c.Wy)(m[t],{timeFormatter:(0,s.mo)(v.dateFormat),numberFormatter:(0,u.gV)(v.numberFormat),coltype:null==V?void 0:V[(0,i.A)(e)]})}))),k(o.clientX,o.clientY,{drillToDetail:h,crossFilter:M(a,r),drillBy:{filters:d,groupbyFieldName:g?"groupby":"groupby_b",adhocFilterFieldName:g?"adhoc_filters":"adhoc_filters_b"}})}}};return(0,h.Y)(o.A,{refs:E,height:e,width:t,echartOptions:a,eventHandlers:O,selectedValues:b})}},85867:(e,t,a)=>{a.d(t,{A:()=>T});var r=a(96540),l=a(96453),n=a(59936),s=a(53826),u=a(72729),i=a(71422),o=a(52428),c=a(49855),h=a(1385),d=a(82523),p=a(97127),f=a(82843),g=a(86915),m=a(13371),b=a(97624),v=a(37340),y=a(9472),w=a(62245),k=a(39925),F=a(84519),x=a(66108),C=a(68948),E=a(2641),V=a(62404),I=a(26334),M=a(93587),N=a(18953),O=a(13525),S=a(2445);const A=l.I4.div`
  height: ${({height:e})=>e};
  width: ${({width:e})=>e};
`;function B({width:e,height:t,echartOptions:a,eventHandlers:l,zrEventHandlers:n,selectedValues:u={},refs:i},o){const c=(0,r.useRef)(null);i&&(i.divRef=c);const h=(0,r.useRef)(),d=(0,r.useMemo)((()=>Object.keys(u)||[]),[u]),p=(0,r.useRef)([]);(0,r.useImperativeHandle)(o,(()=>({getEchartInstance:()=>h.current}))),(0,r.useEffect)((()=>{c.current&&(h.current||(h.current=(0,s.Ts)(c.current)),Object.entries(l||{}).forEach((([e,t])=>{var a,r;null==(a=h.current)||a.off(e),null==(r=h.current)||r.on(e,t)})),Object.entries(n||{}).forEach((([e,t])=>{var a,r;null==(a=h.current)||a.getZr().off(e),null==(r=h.current)||r.getZr().on(e,t)})),h.current.setOption(a,!0))}),[a,l,n]),(0,r.useEffect)((()=>{h.current&&(h.current.dispatchAction({type:"downplay",dataIndex:p.current.filter((e=>!d.includes(e)))}),d.length&&h.current.dispatchAction({type:"highlight",dataIndex:d}),p.current=d)}),[d]);const f=(0,r.useCallback)((({width:e,height:t})=>{h.current&&h.current.resize({width:e,height:t})}),[]);return(0,r.useEffect)((()=>(f({width:e,height:t}),()=>{var e;return null==(e=h.current)?void 0:e.dispose()})),[]),(0,r.useLayoutEffect)((()=>{f({width:e,height:t})}),[e,t,f]),(0,S.Y)(A,{ref:c,height:t,width:e})}(0,n.Y)([k.a,u.a,i.a,o.a,c.a,h.a,d.a,p.a,f.a,g.a,m.a,b.a,v.a,y.a,w.a,F.a,x.a,C.a,E.a,V.a,I.a,M.a,N.a,O._]);const T=(0,r.forwardRef)(B)}}]);
//# sourceMappingURL=003ae4be3e11f812e5d4.chunk.js.map